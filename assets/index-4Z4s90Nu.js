(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const mt="modulepreload",pt=function(e){return"/spaceship-dodge-game/"+e},Re={},E=function(t,n,i){let o=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),c=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));o=Promise.allSettled(n.map(u=>{if(u=pt(u),u in Re)return;Re[u]=!0;const a=u.endsWith(".css"),h=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${h}`))return;const f=document.createElement("link");if(f.rel=a?"stylesheet":mt,a||(f.as="script"),f.crossOrigin="",f.href=u,c&&f.setAttribute("nonce",c),document.head.appendChild(f),a)return new Promise((m,y)=>{f.addEventListener("load",m),f.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${u}`)))})}))}function s(r){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=r,window.dispatchEvent(c),!c.defaultPrevented)throw r}return o.then(r=>{for(const c of r||[])c.status==="rejected"&&s(c.reason);return t().catch(s)})};function Q(e){const t=new Set,n=new Proxy(e,{set(i,o,s){return i[o]=s,t.forEach(r=>r()),!0}});return n.watch=i=>t.add(i),n}const g="ontouchstart"in window||navigator.maxTouchPoints>0,d=Q({value:"START"}),R=Q({value:0}),_=Q({value:0}),M=Q({value:3}),He={value:0},ae={value:0},F=Q({value:!0}),w=[],P=[],N=[35,22,12],ze=[20,50,100],Xe=.8,Ke=2.5,gt=.5,vt=10,T=3,yt=100,v={doubleBlaster:{active:!1,timer:0},shield:{active:!1,timer:0}},l={x:380,y:500,width:30,height:45,speed:7,dx:0,dy:0},Ze=g?2400:1500,Je=70,Et=Object.freeze(Object.defineProperty({__proto__:null,ASTEROID_LEVEL_SIZES:N,ASTEROID_SCORE_VALUES:ze,BASE_OBSTACLE_MAX_SPEED:Ke,BASE_OBSTACLE_MIN_SPEED:Xe,BASE_SPAWN_INTERVAL:Ze,SPAWN_INTERVAL_DECREASE_PER_LEVEL:Je,SPEED_INCREASE_PER_LEVEL:gt,allowSpawning:F,bulletRadius:T,bulletSpeed:vt,bullets:w,fireRate:yt,gameLevel:_,gameState:d,isMobile:g,lastObstacleSpawnTime:He,levelStartTime:ae,obstacles:P,player:l,playerLives:M,powerUps:v,score:R},Symbol.toStringTag,{value:"Module"})),Qe=document.getElementById("startOverlay"),et=document.getElementById("gameOverOverlay"),Pt=document.getElementById("finalScore"),tt=document.getElementById("levelTransitionOverlay"),nt=document.getElementById("pauseOverlay"),wt=document.getElementById("levelUpMessage"),At=document.getElementById("currentLevelInfo"),Lt=document.getElementById("currentScoreInfo"),Be=document.getElementById("livesInfoStart"),De=document.getElementById("livesInfoLevel"),Ge=document.getElementById("livesInfoPause"),Ce=document.getElementById("pauseResumeMessage"),Ne=document.getElementById("startHint"),Ue=document.getElementById("tapToContinueMobile"),ke=document.getElementById("continueButton"),Ve=document.getElementById("startButton"),Ye=document.getElementById("quitButton");function St(){document.querySelectorAll(".game-overlay").forEach(e=>{e.classList.remove("visible")})}function ne(e){e.classList.add("visible")}function A(e,t=0,n=0){switch(St(),Be&&(Be.textContent=`Lives: ${M.value}`),De&&(De.textContent=`Lives: ${M.value}`),Ge&&(Ge.textContent=`Lives: ${M.value}`),Ve&&(Ve.style.display=g?"none":"block"),ke&&(ke.style.display=g?"none":"block"),Ye&&(Ye.style.display=g?"none":"block"),Ue&&(Ue.style.display=g?"block":"none"),e){case"START":Ne&&(Ne.textContent=g?"Tap the Screen to Begin":"Press SPACE or Left Mouse Click to fire!"),ne(Qe);break;case"GAME_OVER":E(()=>Promise.resolve().then(()=>I),void 0).then(i=>i.stopMusic()),Pt.textContent=`Final Score: ${t} (Level ${n+1})`,ne(et);break;case"LEVEL_TRANSITION":E(()=>Promise.resolve().then(()=>I),void 0).then(i=>i.stopMusic()),wt.textContent=`LEVEL ${n+1} !`,At.textContent="Get Ready!",Lt.textContent=`Score: ${t}`,ne(tt);break;case"PAUSED":E(()=>Promise.resolve().then(()=>I),void 0).then(i=>i.stopMusic()),Ce&&(Ce.textContent=g?"Tap to Resume":"Press P to Resume"),ne(nt);break;case"PLAYING":E(()=>Promise.resolve().then(()=>I),void 0).then(i=>i.startMusic());break}document.dispatchEvent(new Event("gameStateChange"))}function ot(e){const t=window.innerWidth,n=window.innerHeight;t<600?(e.width=480,e.height=854,e.style.width="100vw",e.style.height="100vh",e.style.objectFit="contain"):(e.width=t,e.height=n,e.style.width=t+"px",e.style.height=n+"px",e.style.objectFit="contain"),e.style.display="block",e.style.backgroundColor="black"}function it(){confirm("Are you sure you want to quit the game?")&&Promise.all([E(()=>Promise.resolve().then(()=>I),void 0),E(()=>Promise.resolve().then(()=>Et),void 0),E(()=>Promise.resolve().then(()=>st),void 0)]).then(([t,n,i])=>{t.stopMusic(),n.gameState.value="GAME_OVER",n.bullets.length=0,n.obstacles.length=0,Object.keys(n.powerUps).forEach(o=>{n.powerUps[o].active=!1,n.powerUps[o].timer=0}),t.playSound("gameover"),i.showOverlay("GAME_OVER",n.score.value,n.gameLevel.value)})}function lt(e){const t=e.getBoundingClientRect();[Qe,et,tt,nt].forEach(n=>{n.style.width=t.width+"px",n.style.height=t.height+"px",n.style.left=t.left+"px",n.style.top=t.top+"px"})}const st=Object.freeze(Object.defineProperty({__proto__:null,initializeCanvas:ot,quitGame:it,setOverlayDimensions:lt,showOverlay:A},Symbol.toStringTag,{value:"Module"}));function It(e){if(g){e.style.display="none";return}const t=e.getContext("2d"),n=[],i=100;function o(){e.width=window.innerWidth,e.height=window.innerHeight,e.style.width="100vw",e.style.height="100vh",e.style.objectFit="cover"}o(),window.addEventListener("resize",o);for(let r=0;r<i;r++)n.push({x:Math.random()*e.width,y:Math.random()*e.height,radius:Math.random()*1.5+.5,speed:Math.random()*.5+.1});function s(){t.clearRect(0,0,e.width,e.height),t.fillStyle="white";for(const r of n)r.y+=r.speed,r.y>e.height&&(r.y=0,r.x=Math.random()*e.width),t.beginPath(),t.arc(r.x,r.y,r.radius,0,2*Math.PI),t.fill();requestAnimationFrame(s)}s()}const Y="/spaceship-dodge-game/";console.log("[DEBUG] soundManager BASE_URL",Y);let b=.4,S=!1,ue=!1;const p={bgm:null,fire:new Audio(`${Y}sounds/fire.mp3`),break:new Audio(`${Y}sounds/break.mp3`),gameover:new Audio(`${Y}sounds/gameover.mp3`),levelup:new Audio(`${Y}sounds/levelup.mp3`)};Object.entries(p).forEach(([e,t])=>{e!=="bgm"&&(t.volume=b,t.muted=S,t.addEventListener("loadeddata",()=>{console.log("[DEBUG] Audio loaded:",e)}),t.load())});function _t(){return new Promise((e,t)=>{if(ue)return e();try{p.bgm=new Audio(`${Y}sounds/bg-music.mp3`),p.bgm.loop=!0,p.bgm.volume=.001;const n=p.bgm.play();n&&typeof n.then=="function"?n.then(()=>{p.bgm.pause(),p.bgm.currentTime=0,p.bgm.volume=b,p.bgm.muted=S,ue=!0,console.log("[DEBUG] Audio unlocked"),e()}).catch(i=>{console.error("[ERROR] Unlock audio failed:",i),t(i)}):t(new Error("bgm.play() did not return a promise"))}catch(n){console.error("[ERROR] unlockAudio exception:",n),t(n)}})}function fe(){!p.bgm||!ue||S||(p.bgm.currentTime=0,p.bgm.play().catch(e=>{console.error("[ERROR] startMusic failed:",e)}))}function he(){p.bgm&&(p.bgm.pause(),p.bgm.currentTime=0)}function j(){console.log("[DEBUG] muteAll called"),S=!0,Oe()}function U(){console.log("[DEBUG] unmuteAll called"),S=!1,Oe(),fe()}function Oe(){console.log("[DEBUG] applyVolumeAndMute",{isMuted:S,currentVolume:b}),Object.entries(p).forEach(([e,t])=>{t&&(t.volume=S?0:b,t.muted=S)})}function rt(e){b=e,console.log("[DEBUG] setVolume",{currentVolume:e}),S||Oe()}function ee(e){if(!ue||S||!p[e])return;const n=p[e].cloneNode();n.volume=b,n.muted=S,n.play().catch(i=>{console.error(`[ERROR] playSound(${e}) failed:`,i)})}const I=Object.freeze(Object.defineProperty({__proto__:null,get currentVolume(){return b},muteAll:j,playSound:ee,setVolume:rt,sounds:p,startMusic:fe,stopMusic:he,unlockAudio:_t,unmuteAll:U},Symbol.toStringTag,{value:"Module"})),Ae=[];let xe=0;const me=document.createElement("canvas");me.width=T*2;me.height=T*2;const pe=me.getContext("2d");pe.fillStyle="#ffff88";pe.beginPath();pe.arc(T,T,T,0,2*Math.PI);pe.fill();function Tt(e,t){const n=Ae.length>0?Ae.pop():{};return n.x=e,n.y=t,n.radius=T,n.dy=-10,n}function bt(e){Ae.push(e)}function ye(e,t){if(d.value!=="PLAYING")return;const n=Tt(e,t);w.push(n);const i=Date.now(),o=g?250:30;i-xe>o&&(ee("fire"),xe=i)}function Ot(e){for(let t=w.length-1;t>=0;t--){const n=w[t];n.y+=n.dy,n.y+n.radius<0&&(w.splice(t,1),bt(n))}}function Mt(e){w.forEach(t=>{e.drawImage(me,t.x-T,t.y-T)})}function Rt(){if(d.value!=="PLAYING")return;l.overridePosition?(l.x=l.overridePosition.x,l.y=l.overridePosition.y,l.overridePosition=null):(l.x+=l.dx,l.y+=l.dy);const e=document.getElementById("gameCanvas");l.x=Math.max(0,Math.min(l.x,e.width-l.width)),l.y=Math.max(0,Math.min(l.y,e.height-l.height))}function Bt(e){if(d.value!=="PLAYING")return;if(v.shield.active){e.save(),e.shadowColor="#0ff",e.shadowBlur=20,e.strokeStyle="#00ffff",e.lineWidth=4;const dt=l.x+l.width/2,ft=l.y+l.height/2,ht=Math.max(l.width,l.height)*.7;e.beginPath(),e.arc(dt,ft,ht,0,Math.PI*2),e.stroke(),e.restore()}e.strokeStyle="#00ffff",e.lineWidth=2;const t=l.width,n=l.height,i=l.x,o=l.y,s=i+t/2,r=.3;e.beginPath(),e.moveTo(s,o),e.lineTo(i+t*.2,o+n*.8),e.lineTo(s-t*r,o+n*.75),e.lineTo(s+t*r,o+n*.75),e.lineTo(i+t*.8,o+n*.8),e.closePath(),e.stroke();const c=t*.2,u=t*.07,a=n*.3,h=o+n*.75,f=h+a,m=s-c/2,y=s+c/2,B=s-u/2,q=s+u/2;e.beginPath(),e.moveTo(m,h),e.lineTo(y,h),e.lineTo(q,f),e.lineTo(B,f),e.closePath(),e.stroke(),e.beginPath(),e.moveTo(s,h+a*.2),e.lineTo(s,h+a*.8),e.moveTo(s-u*.8,h+a*.3),e.lineTo(s-u*.8,h+a*.7),e.moveTo(s+u*.8,h+a*.3),e.lineTo(s+u*.8,h+a*.7),e.stroke();const k=performance.now()/500,V=(Math.sin(k)+1)/2,L=s,ge=f+5,D=u,ve=e.createRadialGradient(L,ge,0,L,ge,D*3);ve.addColorStop(0,`rgba(0, 255, 255, ${.6*V})`),ve.addColorStop(1,"rgba(0, 255, 255, 0)"),e.fillStyle=ve,e.beginPath(),e.ellipse(L,ge+D,D*1.5,D*3,0,0,Math.PI*2),e.fill(),e.fillStyle=`rgba(0, 255, 255, ${.7*V})`,e.beginPath(),e.moveTo(L-D*.6,f),e.lineTo(L+D*.6,f),e.lineTo(L,f+D*3),e.closePath(),e.fill()}function Le(){v.doubleBlaster.active?(ye(l.x+l.width*.25,l.y),ye(l.x+l.width*.75,l.y)):ye(l.x+l.width/2,l.y)}const Z=[],Se=[];function Ie(e,t,n,i="#ffffff"){if(g)return;let o;Se.length>0?o=Se.pop():o={},o.text=e,o.x=t,o.y=n,o.opacity=1,o.color=i,Z.push(o)}function Dt(){if(!g)for(let e=Z.length-1;e>=0;e--){const t=Z[e];t.y-=.5,t.opacity-=.02,t.opacity<=0&&(Z.splice(e,1),Se.push(t))}}function Gt(e){g||(e.font="16px Inter",Z.forEach(t=>{e.globalAlpha=t.opacity,e.fillStyle=t.color,e.fillText(t.text,t.x,t.y)}),e.globalAlpha=1)}let $e=Xe,Ct=1;const C={};let Nt=Ke;const ce=[];let Me=0;function Ut(){Me=0}function kt(e,t){const n=[],i=Math.PI*2/t;for(let o=0;o<t;o++){const s=o*i,r=e*(.8+Math.random()*.4);n.push({x:r*Math.cos(s),y:r*Math.sin(s)})}return n}function at(e,t,n,i=0,o=0,s=null){const r=N[n],c=ze[n],u=Math.floor(Math.random()*6)+5,a=g?Math.min(u,5):u,h=kt(r,a),f=Ct++;s===null&&(C[f]=0);const m=s??f;typeof C[m]>"u"&&(C[m]=0),n===N.length-1&&C[m]++;const y=Math.random()*(Nt-$e)+$e,B=s===null?y:y*.3,q=Math.random()*2*Math.PI,k=Math.random()*.01-.05,V=Date.now(),L=ce.length>0?ce.pop():{};Object.assign(L,{x:e,y:t,radius:r,speed:B,dx:i,dy:o,shape:h,level:n,scoreValue:c,id:f,parentId:m,rotation:q,rotationSpeed:k,creationTime:V}),P.push(L),n===0&&Me++}function Vt(e,t,n,i,o=!0){const s=Date.now(),r=100,c=3e4;for(let u=0;u<P.length;u++){const a=P[u];a.creationTime||(a.creationTime=s),a.y+=a.speed+a.dy,a.x+=a.dx,a.rotation=(a.rotation+a.rotationSpeed)%(2*Math.PI);const h=a.y>t+r||a.x+a.radius*2<-100||a.x>e+r,f=s-a.creationTime>c;if(h||f){const[m]=P.splice(u,1);ce.push(m),u--}}o&&s-i.value>n&&(at(Math.random()*(e-N[0]*2),-N[0]*2,0),i.value=s)}function Yt(e){e.strokeStyle="#ff4500",e.lineWidth=2,P.forEach(t=>{e.save(),e.translate(t.x+t.radius,t.y+t.radius),e.rotate(t.rotation),e.beginPath(),e.moveTo(t.shape[0].x,t.shape[0].y);for(let n=1;n<t.shape.length;n++)e.lineTo(t.shape[n].x,t.shape[n].y);e.closePath(),e.stroke(),e.restore()})}function xt(e,t){const n=P.indexOf(e);if(n!==-1){if(P.splice(n,1),ce.push(e),ee("break"),e.level<N.length-1){const i=e.level+1,o=Math.floor(Math.random()*2)+2;for(let s=0;s<o;s++){const r=Math.random()*Math.PI*2,c=Math.random()<.8?Math.random()*.7+.3:Math.random()*1.5+1,u=Math.cos(r)*c,a=Math.sin(r)*c;at(e.x+e.radius,e.y+e.radius,i,u,a,e.parentId??e.id)}}t.value+=e.scoreValue,Ie(`+${e.scoreValue}`,e.x+e.radius,e.y),e.parentId!==null&&e.level===N.length-1&&(C[e.parentId]--,C[e.parentId]===0&&(t.value+=150,Ie("+150 (All Fragments)",e.x,e.y-10,"#00ff00"),delete C[e.parentId]))}}const de={DOUBLE_BLASTER:"doubleBlaster",SHIELD:"shield"},J=50,x=[];function $t(e){const t=Math.random()*(e-J),n=-50,i=Math.random()<.5?de.DOUBLE_BLASTER:de.SHIELD;x.push({x:t,y:n,size:J,type:i,dy:1.5})}function Ft(e){for(let t=x.length-1;t>=0;t--){const n=x[t];if(n.y+=n.dy,n.y>e){x.splice(t,1);continue}l.x<n.x+n.size&&l.x+l.width>n.x&&l.y<n.y+n.size&&l.y+l.height>n.y&&(jt(n.type),x.splice(t,1),Ie(`Power-up! ${n.type}`,l.x,l.y-20,"#00ffff"))}Object.keys(v).forEach(t=>{v[t].active&&(v[t].timer--,v[t].timer<=0&&(v[t].active=!1))})}function Wt(e){const n=performance.now()/600,i=g?.85:(Math.sin(n)+1)/2,o=.75+.5*i;x.forEach(s=>{const r=s.x+J/2,c=s.y+J/2,u=J/2;if(e.save(),e.translate(r,c),e.scale(o,o),e.translate(-r,-c),s.type===de.DOUBLE_BLASTER){const h=u*.8,f=h/2.5;g||(e.shadowColor="#f9d71c",e.shadowBlur=15*i),e.fillStyle="#f9d71c",e.beginPath();for(let m=0;m<5;m++){const y=Math.PI/2*3+m*Math.PI*2/5,B=r+Math.cos(y)*h,q=c+Math.sin(y)*h;e.lineTo(B,q);const k=y+Math.PI/5,V=r+Math.cos(k)*f,L=c+Math.sin(k)*f;e.lineTo(V,L)}e.closePath(),e.fill()}else if(s.type===de.SHIELD){const a=u*(.75+.25*i);if(!g){const h=e.createRadialGradient(r,c,a*.1,r,c,a);h.addColorStop(0,`rgba(0, 255, 255, ${.8*i})`),h.addColorStop(1,"rgba(0, 255, 255, 0)"),e.fillStyle=h,e.beginPath(),e.arc(r,c,a,0,Math.PI*2),e.fill()}e.fillStyle="#0ff",e.beginPath(),e.arc(r,c,a*.6,0,Math.PI*2),e.fill()}e.restore()})}function jt(e){v[e].active=!0,v[e].timer=600}function qt(e,t,n,i,o,s,r){const c=Math.max(i,Math.min(e,i+s)),u=Math.max(o,Math.min(t,o+r)),a=e-c,h=t-u;return a*a+h*h<n*n}function Ht(){const e=l.x,t=l.y,n=l.width,i=l.height;for(const o of P){const s=o.x+o.radius,r=o.y+o.radius;if(qt(s,r,o.radius,e,t,n,i))return o}return null}function zt(){for(let e=w.length-1;e>=0;e--){const t=w[e];for(let n=P.length-1;n>=0;n--){const i=P[n],o=t.x-(i.x+i.radius),s=t.y-(i.y+i.radius);if(Math.sqrt(o*o+s*s)<t.radius+i.radius){w.splice(e,1),xt(i,R);break}}}}function Xt(){Ht()&&(v.shield.active||E(()=>Promise.resolve().then(()=>hn),void 0).then(t=>t.handlePlayerHit())),zt()}let H=!1,z=null;const Kt=5e3,Zt=20;function te(){F.value=!0,H=!1,z=null,ae.value=Date.now()}function Jt(e){const t=Date.now();if((t-ae.value)/1e3,Me>=(_.value+1)*Zt&&(F.value=!1),!F.value&&!H&&P.length===0&&(H=!0,z=t),H&&z){const n=t-z,i=t-ae.value;(n>=1500||i>=Kt)&&(_.value++,d.value="LEVEL_TRANSITION",w.length=0,F.value=!0,H=!1,z=null,E(()=>Promise.resolve().then(()=>I),void 0).then(o=>o.playSound("levelup")),E(()=>Promise.resolve().then(()=>I),void 0).then(o=>o.stopMusic()),e())}}function Qt(e){e.fillStyle="#ffffff",e.font='24px "Inter", sans-serif',e.textAlign="left",e.fillText(`Score: ${R.value}`,20,40),e.fillText(`Level: ${_.value+1}`,20,70),e.fillText(`Lives: ${M.value}`,20,100)}function en(e){let i=120;e.font="18px monospace",e.fillStyle="#00ffff",Object.entries(v).forEach(([o,s])=>{if(s.active){const r=Math.ceil(s.timer/60);e.fillText(`${tn(o)}: ${r}s`,20,i),i+=24}})}function tn(e){return e.charAt(0).toUpperCase()+e.slice(1)}function nn(e){d.value==="PLAYING"&&(e.save(),e.globalAlpha=1,e.fillStyle="white",e.font="16px Inter",Bt(e),Yt(e),Mt(e),Wt(e),Qt(e),Gt(e),en(e),e.restore())}const on=60,ln=1e3/on;let Fe=0,W,$,_e,Ee=0;const sn=1e4,ut=300;function rn(e){const t=Ze-e*Je;return Math.max(t,ut)}let We=ut;function an(e){$=e,$.width=window.innerWidth,$.height=window.innerHeight,_e=$.getContext("2d")}function O(){$&&(W=requestAnimationFrame(e=>Te($,e)))}function Te(e,t=0){if(t-Fe<ln){W=requestAnimationFrame(n=>Te(e,n));return}if(Fe=t,d.value!=="PLAYING"){ct();return}_e.clearRect(0,0,e.width,e.height),We=rn(_.value),(!Ee||t-Ee>sn)&&($t(e.width),Ee=t),Rt(),Vt(e.width,e.height,We,He,F.value),Ot(e.height),Ft(e.height),Dt(),Xt(),nn(_e),Jt(()=>{Ut(),te(),E(()=>Promise.resolve().then(()=>st),void 0).then(n=>{n.showOverlay("LEVEL_TRANSITION",R.value,_.value)})}),W=requestAnimationFrame(n=>Te(e,n))}function ct(){W&&(cancelAnimationFrame(W),W=null)}function un(){const e=document.createElement("div");e.style.position="absolute",e.style.top="20px",e.style.right="20px",e.style.zIndex="20",e.style.display="flex",e.style.gap="10px";const t=document.createElement("button");t.textContent="🔇",t.addEventListener("touchstart",o=>{o.preventDefault(),j()},{passive:!1}),t.addEventListener("click",()=>j());const n=document.createElement("button");n.textContent="🔊",n.addEventListener("touchstart",o=>{o.preventDefault(),U()},{passive:!1}),n.addEventListener("click",()=>U());const i=document.createElement("input");i.type="range",i.min="0",i.max="1",i.step="0.05",i.value=b.toString(),i.oninput=o=>{const s=parseFloat(o.target.value);rt(s)},e.appendChild(t),e.appendChild(n),e.appendChild(i),document.body.appendChild(e)}function cn(){M.value-=1,ee("gameover"),M.value<=0?(d.value="GAME_OVER",he(),A("GAME_OVER",R.value,_.value)):(d.value="LEVEL_TRANSITION",dn(),A("LEVEL_TRANSITION",R.value,_.value))}function dn(){l.x=window.innerWidth/2-l.width/2,l.y=window.innerHeight-l.height-50,l.dx=0,l.dy=0,w.length=0,P.length=0,te(),he()}function le(e){d.value="PLAYING",R.value=0,_.value=0,M.value=3,v.shield.active=!1,v.shield.timer=0,v.doubleBlaster.active=!1,v.doubleBlaster.timer=0,w.length=0,P.length=0,l.x=e.width/2-l.width/2,l.y=e.height-l.height-50,l.dx=0,l.dy=0,te(),A("PLAYING"),un(),U(),E(()=>Promise.resolve().then(()=>I),void 0).then(n=>n.startMusic()),e.getContext("2d").clearRect(0,0,e.width,e.height)}function be(){d.value="PLAYING",te(),A("PLAYING"),fe()}function fn(){d.value="GAME_OVER",he(),ee("gameover"),A("GAME_OVER",R.value,_.value)}const hn=Object.freeze(Object.defineProperty({__proto__:null,continueGame:be,endGame:fn,handlePlayerHit:cn,resetLevelFlow:te,showOverlay:A,startGame:le},Symbol.toStringTag,{value:"Module"}));let se=!1,re=null,G=!1,oe=0;const je=150;function mn(e){document.addEventListener("keydown",t=>{if(t.key==="p"&&!G){if(G=!0,d.value!=="PLAYING"&&d.value!=="PAUSED"){G=!1;return}const n=d.value==="PLAYING"?"PAUSED":"PLAYING";d.value=n,A(n),n==="PAUSED"?(j(),Pe()):n==="PLAYING"&&(U(),O()),setTimeout(()=>G=!1,300);return}if(d.value==="PLAYING")switch(t.key){case"ArrowUp":case"w":l.dy=-l.speed;break;case"ArrowDown":case"s":l.dy=l.speed;break;case"ArrowLeft":case"a":l.dx=-l.speed;break;case"ArrowRight":case"d":l.dx=l.speed;break;case" ":const n=Date.now();n-oe>je&&(Le(),oe=n);break}}),document.addEventListener("keyup",t=>{if(d.value==="PLAYING")switch(t.key){case"ArrowUp":case"w":case"ArrowDown":case"s":l.dy=0;break;case"ArrowLeft":case"a":case"ArrowRight":case"d":l.dx=0;break}}),e.addEventListener("mousemove",t=>{if(d.value!=="PLAYING")return;const n=e.getBoundingClientRect(),i=t.clientX-n.left,o=t.clientY-n.top;l.x=i-l.width/2,l.y=o-l.height/2}),e.addEventListener("mousedown",t=>{if(d.value!=="PLAYING"||t.button!==0||se)return;se=!0;function n(){if(!se||d.value!=="PLAYING")return;const i=Date.now();i-oe>je&&(Le(),oe=i),re=setTimeout(n,100)}n()}),e.addEventListener("mouseup",t=>{t.button===0&&Pe()}),e.addEventListener("contextmenu",t=>{if(t.preventDefault(),!G&&(d.value==="PLAYING"||d.value==="PAUSED")){G=!0;const n=d.value==="PLAYING"?"PAUSED":"PLAYING";d.value=n,A(n),n==="PAUSED"?(j(),Pe()):n==="PLAYING"&&(U(),O()),setTimeout(()=>G=!1,300)}})}function Pe(){se=!1,re&&(clearTimeout(re),re=null)}let ie=!1,X=0,K=0,we=null,qe=0;const pn=250;function gn(e){we=e,console.log("[DEBUG] setupMobileInput called",{canvasId:e.id});function t(){if(ie&&d.value==="PLAYING"){vn();const i=performance.now();i-qe>=pn&&(Le(),qe=i,console.log("[DEBUG] Autofire triggered"))}requestAnimationFrame(t)}requestAnimationFrame(t);function n(i){console.log("[DEBUG] handleTouchStart triggered",i.target),i.preventDefault();const o=document.querySelector(".game-overlay.visible");if(o&&o.contains(i.target)){console.log("[DEBUG] Touch blocked — inside active overlay");return}const s=i.touches[0];if(!s){console.warn("[WARN] No touch object found");return}const r=we.getBoundingClientRect();X=s.clientX-r.left,K=s.clientY-r.top,ie=!0,console.log("[DEBUG] TOUCH START",{touchX:X,touchY:K,state:d.value})}e.addEventListener("touchstart",n,{passive:!1}),console.log("[DEBUG] Bound touchstart to canvas"),e.addEventListener("touchmove",i=>{i.preventDefault();const o=i.touches[0];if(!o)return;const s=we.getBoundingClientRect();X=o.clientX-s.left,K=o.clientY-s.top,console.log("[DEBUG] TOUCH MOVE",{touchX:X,touchY:K})},{passive:!1}),console.log("[DEBUG] Bound touchmove to canvas"),document.addEventListener("touchend",()=>{console.log("[DEBUG] TOUCH END"),ie&&(ie=!1,d.value==="PLAYING"&&(console.log("[DEBUG] Switching state to PAUSED"),d.value="PAUSED",A("PAUSED"),j(),ct()))},{passive:!1})}function vn(){l.overridePosition={x:X-l.width/2,y:K-l.height/2},l.dx=0,l.dy=0,console.log("[DEBUG] player.overridePosition set",l.overridePosition)}console.log("[DEBUG] main.js is running");function yn(){console.log("[DEBUG] init running — DOM loaded");const e=document.getElementById("gameCanvas"),t=document.getElementById("startButton"),n=document.getElementById("restartButton"),i=document.getElementById("continueButton"),o=document.getElementById("quitButton"),s=document.getElementById("startOverlay"),r=document.getElementById("pauseOverlay"),c=document.getElementById("levelTransitionOverlay"),u=document.getElementById("starfieldCanvas");if(console.log("[DEBUG] startOverlay element:",s),!s){console.error("[ERROR] startOverlay not found in DOM.");return}!g&&u&&It(u),ot(e),lt(e),an(e);const a="ontouchstart"in window?"touchstart":"click",h=f=>{if(f.preventDefault(),d.value==="START"){console.log("[DEBUG] Starting game from overlay");try{const m=p==null?void 0:p.bgm;if(m){m.volume=.001;const y=m.play();y&&typeof y.then=="function"&&y.then(()=>{m.pause(),m.currentTime=0,m.volume=b,U(),fe()}).catch(B=>{console.warn("[WARN] Audio unlock play() failed:",B)})}}catch(m){console.warn("[WARN] Audio unlock block threw error:",m)}le(e),O()}};s.addEventListener(a,h,{passive:!1}),g?(gn(e),r==null||r.addEventListener("touchstart",f=>{f.preventDefault(),d.value==="PAUSED"&&(console.log("[DEBUG] Resuming game from overlay touch"),d.value="PLAYING",A("PLAYING"),E(()=>Promise.resolve().then(()=>I),void 0).then(m=>m.unmuteAll()),O())},{passive:!1}),c==null||c.addEventListener("touchstart",f=>{f.preventDefault(),d.value==="LEVEL_TRANSITION"&&(console.log("[DEBUG] Resuming from level transition overlay"),be(),O())},{passive:!1})):(mn(e),t==null||t.addEventListener("click",()=>{d.value==="START"&&E(()=>Promise.resolve().then(()=>I),void 0).then(f=>{f.unlockAudio().then(()=>{f.startMusic(),le(e),O()})})}),i==null||i.addEventListener("click",()=>{be(),O()}),o==null||o.addEventListener("click",()=>{it()})),n==null||n.addEventListener("click",()=>{le(e),O()}),A("START")}window.addEventListener("DOMContentLoaded",yn);
