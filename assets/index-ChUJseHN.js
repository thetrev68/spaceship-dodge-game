(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function o(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=o(n);fetch(n.href,s)}})();const ft="modulepreload",ht=function(e){return"/spaceship-dodge-game/"+e},Ge={},v=function(t,o,i){let n=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),u=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));n=Promise.allSettled(o.map(a=>{if(a=ht(a),a in Ge)return;Ge[a]=!0;const c=a.endsWith(".css"),f=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${f}`))return;const h=document.createElement("link");if(h.rel=c?"stylesheet":ft,c||(h.as="script"),h.crossOrigin="",h.href=a,u&&h.setAttribute("nonce",u),document.head.appendChild(h),c)return new Promise((E,_)=>{h.addEventListener("load",E),h.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${a}`)))})}))}function s(l){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=l,window.dispatchEvent(u),!u.defaultPrevented)throw l}return n.then(l=>{for(const u of l||[])u.status==="rejected"&&s(u.reason);return t().catch(s)})};function te(e){const t=new Set,o=new Proxy(e,{set(i,n,s){return i[n]=s,t.forEach(l=>l()),!0}});return o.watch=i=>t.add(i),o}const g="ontouchstart"in window||navigator.maxTouchPoints>0,d=te({value:"START"}),O=te({value:0}),I=te({value:0}),b=te({value:3}),He={value:0},me={value:0},F=te({value:!0}),P=[],y=[],k=[35,22,12],ze=[20,50,100],qe=.8,Ke=2.5,mt=.5,pt=10,T=3,gt=100,p={doubleBlaster:{active:!1,timer:0},shield:{active:!1,timer:0}},r={x:380,y:500,width:30,height:45,speed:7,dx:0,dy:0},Ze=g?2400:1500,Je=70,vt=Object.freeze(Object.defineProperty({__proto__:null,ASTEROID_LEVEL_SIZES:k,ASTEROID_SCORE_VALUES:ze,BASE_OBSTACLE_MAX_SPEED:Ke,BASE_OBSTACLE_MIN_SPEED:qe,BASE_SPAWN_INTERVAL:Ze,SPAWN_INTERVAL_DECREASE_PER_LEVEL:Je,SPEED_INCREASE_PER_LEVEL:mt,allowSpawning:F,bulletRadius:T,bulletSpeed:pt,bullets:P,fireRate:gt,gameLevel:I,gameState:d,isMobile:g,lastObstacleSpawnTime:He,levelStartTime:me,obstacles:y,player:r,playerLives:b,powerUps:p,score:O},Symbol.toStringTag,{value:"Module"})),le=document.getElementById("startOverlay"),re=document.getElementById("gameOverOverlay"),Et=document.getElementById("finalScore"),ae=document.getElementById("levelTransitionOverlay"),ce=document.getElementById("pauseOverlay"),yt=document.getElementById("levelUpMessage"),wt=document.getElementById("currentLevelInfo"),Pt=document.getElementById("currentScoreInfo"),Ue=document.getElementById("livesInfoStart"),ke=document.getElementById("livesInfoLevel"),Ne=document.getElementById("livesInfoPause"),Ve=document.getElementById("pauseResumeMessage"),xe=document.getElementById("startHint");function A(e,t=0,o=0){switch([le,ce,re,ae].forEach(n=>{n.classList.add("hidden"),n.classList.remove("flex")}),Ue&&(Ue.textContent=`Lives: ${b.value}`),ke&&(ke.textContent=`Lives: ${b.value}`),Ne&&(Ne.textContent=`Lives: ${b.value}`),e){case"START":xe&&(xe.textContent=g?"Tap the Screen to Begin":"Press SPACE or Left Mouse Click to fire!"),le.classList.remove("hidden"),le.classList.add("flex");break;case"GAME_OVER":v(()=>Promise.resolve().then(()=>S),void 0).then(n=>n.stopMusic()),Et.textContent=`Final Score: ${t} (Level ${o+1})`,re.classList.remove("hidden"),re.classList.add("flex");break;case"LEVEL_TRANSITION":v(()=>Promise.resolve().then(()=>S),void 0).then(n=>n.stopMusic()),yt.textContent=`LEVEL ${o+1} !`,wt.textContent="Get Ready!",Pt.textContent=`Score: ${t}`,ae.classList.remove("hidden"),ae.classList.add("flex");break;case"PAUSED":v(()=>Promise.resolve().then(()=>S),void 0).then(n=>n.stopMusic()),Ve&&(Ve.textContent=g?"Tap to Resume":"Press P to Resume"),ce.classList.remove("hidden"),ce.classList.add("flex");break;case"PLAYING":document.querySelectorAll(".game-overlay").forEach(n=>{n.classList.add("hidden"),n.classList.remove("flex")}),v(()=>Promise.resolve().then(()=>S),void 0).then(n=>n.startMusic());break}document.dispatchEvent(new Event("gameStateChange"))}function Qe(e){const t=window.innerWidth,o=window.innerHeight;t<600?(e.width=480,e.height=854,e.style.width="100vw",e.style.height="100vh",e.style.objectFit="contain",e.style.display="block",e.style.backgroundColor="black"):(e.width=t*.9,e.height=o*.9,e.style.width="",e.style.height="",e.style.objectFit="",e.style.backgroundColor="")}function et(){confirm("Are you sure you want to quit the game?")&&Promise.all([v(()=>Promise.resolve().then(()=>S),void 0),v(()=>Promise.resolve().then(()=>vt),void 0),v(()=>Promise.resolve().then(()=>ot),void 0)]).then(([t,o,i])=>{t.stopMusic(),o.gameState.value="GAME_OVER",o.bullets.length=0,o.obstacles.length=0,Object.keys(o.powerUps).forEach(n=>{o.powerUps[n].active=!1,o.powerUps[n].timer=0}),t.playSound("gameover"),i.showOverlay("GAME_OVER",o.score.value,o.gameLevel.value)})}function tt(e){const t=e.getBoundingClientRect();[le,re,ae,ce].forEach(o=>{o.style.width=t.width+"px",o.style.height=t.height+"px",o.style.left=t.left+"px",o.style.top=t.top+"px"})}const ot=Object.freeze(Object.defineProperty({__proto__:null,initializeCanvas:Qe,quitGame:et,setOverlayDimensions:tt,showOverlay:A},Symbol.toStringTag,{value:"Module"}));function At(e){if(g){e.style.display="none";return}const t=e.getContext("2d"),o=[],i=100;function n(){e.width=window.innerWidth,e.height=window.innerHeight,e.style.width="100vw",e.style.height="100vh",e.style.objectFit="cover"}n(),window.addEventListener("resize",n);for(let l=0;l<i;l++)o.push({x:Math.random()*e.width,y:Math.random()*e.height,radius:Math.random()*1.5+.5,speed:Math.random()*.5+.1});function s(){t.clearRect(0,0,e.width,e.height),t.fillStyle="white";for(const l of o)l.y+=l.speed,l.y>e.height&&(l.y=0,l.x=Math.random()*e.width),t.beginPath(),t.arc(l.x,l.y,l.radius,0,2*Math.PI),t.fill();requestAnimationFrame(s)}s()}const x="/spaceship-dodge-game/";console.log("[DEBUG] soundManager BASE_URL",x);const Lt=/Mobi|Android/i.test(navigator.userAgent),m={bgm:new Audio(`${x}sounds/bg-music.mp3`),fire:`${x}sounds/fire.mp3`,break:`${x}sounds/break.mp3`,gameover:`${x}sounds/gameover.mp3`,levelup:`${x}sounds/levelup.mp3`};Object.values(m).forEach((e,t)=>{typeof e!="string"&&(e.addEventListener("error",()=>{console.error("[ERROR] Audio load failed:",Object.keys(m)[t])}),e.addEventListener("loadeddata",()=>{console.log("[DEBUG] Audio loaded:",Object.keys(m)[t])}),e.load())});let R=.4,w=!1,ee=!1,ie=null;const ue={},St=Lt?4:8;m.bgm.loop=!0;ve();function ve(){console.log("[DEBUG] applyVolumeAndMute",{isMuted:w,currentVolume:R}),m.bgm.volume=w?0:R,m.bgm.muted=w,Object.values(ue).flat().forEach(e=>{e.volume=w?0:R,e.muted=w})}function nt(e){R=e,console.log("[DEBUG] setVolume",{currentVolume:e}),w||ve()}function W(){console.log("[DEBUG] muteAll called"),w=!0,ve()}function X(){console.log("[DEBUG] unmuteAll called"),w=!1,ve(),Ee()}function oe(e){if(console.log("[DEBUG] playSound",{name:e}),w||!m[e])return;ee||it();const t=m[e];if(typeof t!="string")return;ue[e]||(ue[e]=[]);const o=ue[e];for(const i of o)if(i.paused||i.ended){i.currentTime=0,i.play().catch(n=>console.error("[ERROR] playSound failed:",n));return}if(o.length<St){const i=new Audio(t);i.volume=R,i.muted=w,i.play().catch(n=>console.error("[ERROR] playSound new audio failed:",n)),o.push(i)}}function Ee(){console.log("[DEBUG] startMusic called",{isAudioUnlocked:ee,isMuted:w}),!(w||!ee)&&(m.bgm.currentTime=0,m.bgm.volume=R,m.bgm.muted=w,m.bgm.play().catch(e=>console.error("[ERROR] startMusic failed:",e)))}function ye(){console.log("[DEBUG] stopMusic called"),m.bgm.pause(),m.bgm.currentTime=0}function it(){if(console.log("[DEBUG] unlockAudio called"),!ee)try{ie=ie||new(window.AudioContext||window.webkitAudioContext),ie.state==="suspended"&&ie.resume().then(()=>{console.log("[DEBUG] AudioContext resumed")}).catch(t=>console.error("[ERROR] AudioContext resume failed:",t));const e=[m.bgm];Object.keys(m).forEach(t=>{if(t==="bgm")return;const o=m[t],i=new Audio(o);i.volume=0,i.play().then(()=>{i.pause(),i.currentTime=0}).catch(n=>console.error("[ERROR] Preload sound failed:",t,n))}),Promise.all(e.map(t=>t.play().then(()=>{t.pause(),t.currentTime=0}).catch(o=>console.error("[ERROR] Unlock audio failed:",o)))).then(()=>{ee=!0,console.log("[DEBUG] Audio context unlocked"),Ee()}).catch(t=>console.error("[ERROR] unlockAudio Promise.all failed:",t))}catch(e){console.error("[ERROR] unlockAudio failed:",e)}}const S=Object.freeze(Object.defineProperty({__proto__:null,get currentVolume(){return R},muteAll:W,playSound:oe,setVolume:nt,startMusic:Ee,stopMusic:ye,unlockAudio:it,unmuteAll:X},Symbol.toStringTag,{value:"Module"})),be=[];let Ye=0;const we=document.createElement("canvas");we.width=T*2;we.height=T*2;const Pe=we.getContext("2d");Pe.fillStyle="#ffff88";Pe.beginPath();Pe.arc(T,T,T,0,2*Math.PI);Pe.fill();function _t(e,t){const o=be.length>0?be.pop():{};return o.x=e,o.y=t,o.radius=T,o.dy=-10,o}function It(e){be.push(e)}function Se(e,t){if(d.value!=="PLAYING")return;const o=_t(e,t);P.push(o);const i=Date.now(),n=g?250:30;i-Ye>n&&(oe("fire"),Ye=i)}function Tt(e){for(let t=P.length-1;t>=0;t--){const o=P[t];o.y+=o.dy,o.y+o.radius<0&&(P.splice(t,1),It(o))}}function bt(e){P.forEach(t=>{e.drawImage(we,t.x-T,t.y-T)})}function Rt(){if(d.value!=="PLAYING")return;r.x+=r.dx,r.y+=r.dy;const e=document.getElementById("gameCanvas");r.x=Math.max(0,Math.min(r.x,e.width-r.width)),r.y=Math.max(0,Math.min(r.y,e.height-r.height))}function Ot(e){if(d.value!=="PLAYING")return;if(p.shield.active){e.save(),e.shadowColor="#0ff",e.shadowBlur=20,e.strokeStyle="#00ffff",e.lineWidth=4;const ct=r.x+r.width/2,ut=r.y+r.height/2,dt=Math.max(r.width,r.height)*.7;e.beginPath(),e.arc(ct,ut,dt,0,Math.PI*2),e.stroke(),e.restore()}e.strokeStyle="#00ffff",e.lineWidth=2;const t=r.width,o=r.height,i=r.x,n=r.y,s=i+t/2,l=.3;e.beginPath(),e.moveTo(s,n),e.lineTo(i+t*.2,n+o*.8),e.lineTo(s-t*l,n+o*.75),e.lineTo(s+t*l,n+o*.75),e.lineTo(i+t*.8,n+o*.8),e.closePath(),e.stroke();const u=t*.2,a=t*.07,c=o*.3,f=n+o*.75,h=f+c,E=s-u/2,_=s+u/2,H=s-a/2,z=s+a/2;e.beginPath(),e.moveTo(E,f),e.lineTo(_,f),e.lineTo(z,h),e.lineTo(H,h),e.closePath(),e.stroke(),e.beginPath(),e.moveTo(s,f+c*.2),e.lineTo(s,f+c*.8),e.moveTo(s-a*.8,f+c*.3),e.lineTo(s-a*.8,f+c*.7),e.moveTo(s+a*.8,f+c*.3),e.lineTo(s+a*.8,f+c*.7),e.stroke();const N=performance.now()/500,V=(Math.sin(N)+1)/2,L=s,Ae=h+5,M=a,Le=e.createRadialGradient(L,Ae,0,L,Ae,M*3);Le.addColorStop(0,`rgba(0, 255, 255, ${.6*V})`),Le.addColorStop(1,"rgba(0, 255, 255, 0)"),e.fillStyle=Le,e.beginPath(),e.ellipse(L,Ae+M,M*1.5,M*3,0,0,Math.PI*2),e.fill(),e.fillStyle=`rgba(0, 255, 255, ${.7*V})`,e.beginPath(),e.moveTo(L-M*.6,h),e.lineTo(L+M*.6,h),e.lineTo(L,h+M*3),e.closePath(),e.fill()}function Re(){p.doubleBlaster.active?(Se(r.x+r.width*.25,r.y),Se(r.x+r.width*.75,r.y)):Se(r.x+r.width/2,r.y)}const J=[],Oe=[];function Me(e,t,o,i="#ffffff"){if(g)return;let n;Oe.length>0?n=Oe.pop():n={},n.text=e,n.x=t,n.y=o,n.opacity=1,n.color=i,J.push(n)}function Mt(){if(!g)for(let e=J.length-1;e>=0;e--){const t=J[e];t.y-=.5,t.opacity-=.02,t.opacity<=0&&(J.splice(e,1),Oe.push(t))}}function Dt(e){g||(e.font="16px Inter",J.forEach(t=>{e.globalAlpha=t.opacity,e.fillStyle=t.color,e.fillText(t.text,t.x,t.y)}),e.globalAlpha=1)}let $e=qe,Bt=1;const U={};let Ct=Ke;const pe=[];let Ce=0;function Gt(){Ce=0}function Ut(e,t){const o=[],i=Math.PI*2/t;for(let n=0;n<t;n++){const s=n*i,l=e*(.8+Math.random()*.4);o.push({x:l*Math.cos(s),y:l*Math.sin(s)})}return o}function st(e,t,o,i=0,n=0,s=null){const l=k[o],u=ze[o],a=Math.floor(Math.random()*6)+5,c=g?Math.min(a,5):a,f=Ut(l,c),h=Bt++;s===null&&(U[h]=0);const E=s??h;typeof U[E]>"u"&&(U[E]=0),o===k.length-1&&U[E]++;const _=Math.random()*(Ct-$e)+$e,H=s===null?_:_*.3,z=Math.random()*2*Math.PI,N=Math.random()*.01-.05,V=Date.now(),L=pe.length>0?pe.pop():{};Object.assign(L,{x:e,y:t,radius:l,speed:H,dx:i,dy:n,shape:f,level:o,scoreValue:u,id:h,parentId:E,rotation:z,rotationSpeed:N,creationTime:V}),y.push(L),o===0&&Ce++}function kt(e,t,o,i,n=!0){const s=Date.now(),l=100,u=3e4;for(let a=0;a<y.length;a++){const c=y[a];c.creationTime||(c.creationTime=s),c.y+=c.speed+c.dy,c.x+=c.dx,c.rotation=(c.rotation+c.rotationSpeed)%(2*Math.PI);const f=c.y>t+l||c.x+c.radius*2<-100||c.x>e+l,h=s-c.creationTime>u;if(f||h){const[E]=y.splice(a,1);pe.push(E),a--}}n&&s-i.value>o&&(st(Math.random()*(e-k[0]*2),-k[0]*2,0),i.value=s)}function Nt(e){e.strokeStyle="#ff4500",e.lineWidth=2,y.forEach(t=>{e.save(),e.translate(t.x+t.radius,t.y+t.radius),e.rotate(t.rotation),e.beginPath(),e.moveTo(t.shape[0].x,t.shape[0].y);for(let o=1;o<t.shape.length;o++)e.lineTo(t.shape[o].x,t.shape[o].y);e.closePath(),e.stroke(),e.restore()})}function Vt(e,t){const o=y.indexOf(e);if(o!==-1){if(y.splice(o,1),pe.push(e),oe("break"),e.level<k.length-1){const i=e.level+1,n=Math.floor(Math.random()*2)+2;for(let s=0;s<n;s++){const l=Math.random()*Math.PI*2,u=Math.random()<.8?Math.random()*.7+.3:Math.random()*1.5+1,a=Math.cos(l)*u,c=Math.sin(l)*u;st(e.x+e.radius,e.y+e.radius,i,a,c,e.parentId??e.id)}}t.value+=e.scoreValue,Me(`+${e.scoreValue}`,e.x+e.radius,e.y),e.parentId!==null&&e.level===k.length-1&&(U[e.parentId]--,U[e.parentId]===0&&(t.value+=150,Me("+150 (All Fragments)",e.x,e.y-10,"#00ff00"),delete U[e.parentId]))}}const ge={DOUBLE_BLASTER:"doubleBlaster",SHIELD:"shield"},Q=50,Y=[];function xt(e){const t=Math.random()*(e-Q),o=-50,i=Math.random()<.5?ge.DOUBLE_BLASTER:ge.SHIELD;Y.push({x:t,y:o,size:Q,type:i,dy:1.5})}function Yt(e){for(let t=Y.length-1;t>=0;t--){const o=Y[t];if(o.y+=o.dy,o.y>e){Y.splice(t,1);continue}r.x<o.x+o.size&&r.x+r.width>o.x&&r.y<o.y+o.size&&r.y+r.height>o.y&&(Ft(o.type),Y.splice(t,1),Me(`Power-up! ${o.type}`,r.x,r.y-20,"#00ffff"))}Object.keys(p).forEach(t=>{p[t].active&&(p[t].timer--,p[t].timer<=0&&(p[t].active=!1))})}function $t(e){const o=performance.now()/600,i=g?.85:(Math.sin(o)+1)/2,n=.75+.5*i;Y.forEach(s=>{const l=s.x+Q/2,u=s.y+Q/2,a=Q/2;if(e.save(),e.translate(l,u),e.scale(n,n),e.translate(-l,-u),s.type===ge.DOUBLE_BLASTER){const f=a*.8,h=f/2.5;g||(e.shadowColor="#f9d71c",e.shadowBlur=15*i),e.fillStyle="#f9d71c",e.beginPath();for(let E=0;E<5;E++){const _=Math.PI/2*3+E*Math.PI*2/5,H=l+Math.cos(_)*f,z=u+Math.sin(_)*f;e.lineTo(H,z);const N=_+Math.PI/5,V=l+Math.cos(N)*h,L=u+Math.sin(N)*h;e.lineTo(V,L)}e.closePath(),e.fill()}else if(s.type===ge.SHIELD){const c=a*(.75+.25*i);if(!g){const f=e.createRadialGradient(l,u,c*.1,l,u,c);f.addColorStop(0,`rgba(0, 255, 255, ${.8*i})`),f.addColorStop(1,"rgba(0, 255, 255, 0)"),e.fillStyle=f,e.beginPath(),e.arc(l,u,c,0,Math.PI*2),e.fill()}e.fillStyle="#0ff",e.beginPath(),e.arc(l,u,c*.6,0,Math.PI*2),e.fill()}e.restore()})}function Ft(e){p[e].active=!0,p[e].timer=600}function jt(e,t,o,i,n,s,l){const u=Math.max(i,Math.min(e,i+s)),a=Math.max(n,Math.min(t,n+l)),c=e-u,f=t-a;return c*c+f*f<o*o}function Wt(){const e=r.x,t=r.y,o=r.width,i=r.height;for(const n of y){const s=n.x+n.radius,l=n.y+n.radius;if(jt(s,l,n.radius,e,t,o,i))return n}return null}function Xt(){for(let e=P.length-1;e>=0;e--){const t=P[e];for(let o=y.length-1;o>=0;o--){const i=y[o],n=t.x-(i.x+i.radius),s=t.y-(i.y+i.radius);if(Math.sqrt(n*n+s*s)<t.radius+i.radius){P.splice(e,1),Vt(i,O);break}}}}function Ht(){Wt()&&(p.shield.active||v(()=>Promise.resolve().then(()=>uo),void 0).then(t=>t.handlePlayerHit())),Xt()}let K=!1,Z=null;const zt=5e3,qt=20;function ne(){F.value=!0,K=!1,Z=null,me.value=Date.now()}function Kt(e){const t=Date.now();if((t-me.value)/1e3,Ce>=(I.value+1)*qt&&(F.value=!1),!F.value&&!K&&y.length===0&&(K=!0,Z=t),K&&Z){const o=t-Z,i=t-me.value;(o>=1500||i>=zt)&&(I.value++,d.value="LEVEL_TRANSITION",P.length=0,F.value=!0,K=!1,Z=null,v(()=>Promise.resolve().then(()=>S),void 0).then(n=>n.playSound("levelup")),v(()=>Promise.resolve().then(()=>S),void 0).then(n=>n.stopMusic()),e())}}function Zt(e){e.fillStyle="#ffffff",e.font='24px "Inter", sans-serif',e.textAlign="left",e.fillText(`Score: ${O.value}`,20,40),e.fillText(`Level: ${I.value+1}`,20,70),e.fillText(`Lives: ${b.value}`,20,100)}function Jt(e){let i=120;e.font="18px monospace",e.fillStyle="#00ffff",Object.entries(p).forEach(([n,s])=>{if(s.active){const l=Math.ceil(s.timer/60);e.fillText(`${Qt(n)}: ${l}s`,20,i),i+=24}})}function Qt(e){return e.charAt(0).toUpperCase()+e.slice(1)}function eo(e){d.value==="PLAYING"&&(e.save(),e.globalAlpha=1,e.fillStyle="white",e.font="16px Inter",Ot(e),Nt(e),bt(e),$t(e),Zt(e),Dt(e),Jt(e),e.restore())}const to=60,oo=1e3/to;let Fe=0,j,$,De,_e=0;const no=1e4,lt=300;function io(e){const t=Ze-e*Je;return Math.max(t,lt)}let je=lt;function so(e){$=e,$.width=window.innerWidth,$.height=window.innerHeight,De=$.getContext("2d")}function G(){$&&(j=requestAnimationFrame(e=>Be($,e)))}function Be(e,t=0){if(t-Fe<oo){j=requestAnimationFrame(o=>Be(e,o));return}if(Fe=t,d.value!=="PLAYING"){rt();return}De.clearRect(0,0,e.width,e.height),je=io(I.value),(!_e||t-_e>no)&&(xt(e.width),_e=t),Rt(),kt(e.width,e.height,je,He,F.value),Tt(e.height),Yt(e.height),Mt(),Ht(),eo(De),Kt(()=>{Gt(),ne(),v(()=>Promise.resolve().then(()=>ot),void 0).then(o=>{o.showOverlay("LEVEL_TRANSITION",O.value,I.value)})}),j=requestAnimationFrame(o=>Be(e,o))}function rt(){j&&(cancelAnimationFrame(j),j=null)}function lo(){const e=document.createElement("div");e.style.position="absolute",e.style.top="20px",e.style.right="20px",e.style.zIndex="20",e.style.display="flex",e.style.gap="10px";const t=document.createElement("button");t.textContent="🔇",t.addEventListener("touchstart",n=>{n.preventDefault(),W()},{passive:!1}),t.addEventListener("click",()=>W());const o=document.createElement("button");o.textContent="🔊",o.addEventListener("touchstart",n=>{n.preventDefault(),X()},{passive:!1}),o.addEventListener("click",()=>X());const i=document.createElement("input");i.type="range",i.min="0",i.max="1",i.step="0.05",i.value=R.toString(),i.oninput=n=>{const s=parseFloat(n.target.value);nt(s)},e.appendChild(t),e.appendChild(o),e.appendChild(i),document.body.appendChild(e)}function ro(){b.value-=1,oe("gameover"),b.value<=0?(d.value="GAME_OVER",ye(),A("GAME_OVER",O.value,I.value)):(d.value="LEVEL_TRANSITION",ao(),A("LEVEL_TRANSITION",O.value,I.value))}function ao(){r.x=window.innerWidth/2-r.width/2,r.y=window.innerHeight-r.height-50,r.dx=0,r.dy=0,P.length=0,y.length=0,ne(),ye()}function de(e){d.value="PLAYING",O.value=0,I.value=0,b.value=3,p.shield.active=!1,p.shield.timer=0,p.doubleBlaster.active=!1,p.doubleBlaster.timer=0,P.length=0,y.length=0,r.x=e.width/2-r.width/2,r.y=e.height-r.height-50,r.dx=0,r.dy=0,ne(),A("PLAYING"),lo(),X(),v(()=>Promise.resolve().then(()=>S),void 0).then(o=>o.startMusic()),e.getContext("2d").clearRect(0,0,e.width,e.height)}function at(){d.value="PLAYING",ne(),A("PLAYING"),Ee()}function co(){d.value="GAME_OVER",ye(),oe("gameover"),A("GAME_OVER",O.value,I.value)}const uo=Object.freeze(Object.defineProperty({__proto__:null,continueGame:at,endGame:co,handlePlayerHit:ro,resetLevelFlow:ne,showOverlay:A,startGame:de},Symbol.toStringTag,{value:"Module"}));let fe=!1,he=null,D=!1,se=0;const We=150;function fo(e){document.addEventListener("keydown",t=>{if(t.key==="p"&&!D){if(D=!0,d.value!=="PLAYING"&&d.value!=="PAUSED"){D=!1;return}const o=d.value==="PLAYING"?"PAUSED":"PLAYING";d.value=o,A(o),o==="PAUSED"?(W(),Ie()):o==="PLAYING"&&(X(),G()),setTimeout(()=>D=!1,300);return}if(d.value==="PLAYING")switch(t.key){case"ArrowUp":case"w":r.dy=-r.speed;break;case"ArrowDown":case"s":r.dy=r.speed;break;case"ArrowLeft":case"a":r.dx=-r.speed;break;case"ArrowRight":case"d":r.dx=r.speed;break;case" ":const o=Date.now();o-se>We&&(Re(),se=o);break}}),document.addEventListener("keyup",t=>{if(d.value==="PLAYING")switch(t.key){case"ArrowUp":case"w":case"ArrowDown":case"s":r.dy=0;break;case"ArrowLeft":case"a":case"ArrowRight":case"d":r.dx=0;break}}),e.addEventListener("mousemove",t=>{if(d.value!=="PLAYING")return;const o=e.getBoundingClientRect(),i=t.clientX-o.left,n=t.clientY-o.top;r.x=i-r.width/2,r.y=n-r.height/2}),e.addEventListener("mousedown",t=>{if(d.value!=="PLAYING"||t.button!==0||fe)return;fe=!0;function o(){if(!fe||d.value!=="PLAYING")return;const i=Date.now();i-se>We&&(Re(),se=i),he=setTimeout(o,100)}o()}),e.addEventListener("mouseup",t=>{t.button===0&&Ie()}),e.addEventListener("contextmenu",t=>{if(t.preventDefault(),!D&&(d.value==="PLAYING"||d.value==="PAUSED")){D=!0;const o=d.value==="PLAYING"?"PAUSED":"PLAYING";d.value=o,A(o),o==="PAUSED"?(W(),Ie()):o==="PLAYING"&&(X(),G()),setTimeout(()=>D=!1,300)}})}function Ie(){fe=!1,he&&(clearTimeout(he),he=null)}let Te=!1,B=0,C=0,q=null,Xe=0;const ho=250;function mo(e){q=e,console.log("[DEBUG] setupMobileInput called",{canvasId:e.id}),setInterval(()=>{console.log("[DEBUG] gameState:",d.value)},1e3);function t(){if(Te&&d.value==="PLAYING"){po();const n=performance.now();n-Xe>=ho&&(Re(),Xe=n)}requestAnimationFrame(t)}requestAnimationFrame(t);function o(n){if(n.preventDefault(),console.log("[DEBUG] handleTouchStart triggered",{targetId:n.target.id,touches:n.touches.length}),n.target.closest(".game-overlay")||n.target.tagName==="BUTTON")return;const s=n.touches[0];if(!s)return;const l=q.getBoundingClientRect();B=s.clientX-l.left,C=s.clientY-l.top,Te=!0,console.log("[DEBUG] TOUCH START",{touchX:B,touchY:C,state:d.value})}e.addEventListener("touchstart",o,{passive:!1}),e.addEventListener("touchmove",n=>{n.preventDefault();const s=n.touches[0];if(!s)return;const l=q.getBoundingClientRect();B=s.clientX-l.left,C=s.clientY-l.top,console.log("[DEBUG] TOUCH MOVE",{touchX:B,touchY:C})},{passive:!1}),document.addEventListener("touchstart",n=>{console.log("[DEBUG] Document touchstart raw",{target:n.target.id||n.target.tagName});const s=n.touches[0];if(!s)return;const l=q.getBoundingClientRect(),u=s.clientX,a=s.clientY;u>=l.left&&u<=l.right&&a>=l.top&&a<=l.bottom&&(console.log("[DEBUG] Document touchstart fallback triggered",{x:u,y:a}),o(n))},{passive:!1}),document.addEventListener("touchmove",n=>{n.preventDefault(),console.log("[DEBUG] Document touchmove raw",{target:n.target.id||n.target.tagName});const s=n.touches[0];if(!s)return;const l=q.getBoundingClientRect(),u=s.clientX,a=s.clientY;u>=l.left&&u<=l.right&&a>=l.top&&a<=l.bottom&&(B=s.clientX-l.left,C=s.clientY-l.top,console.log("[DEBUG] Document touchmove fallback",{touchX:B,touchY:C}))},{passive:!1});const i=()=>{console.log("[DEBUG] TOUCH END"),Te=!1,d.value==="PLAYING"&&(console.log("[DEBUG] Switching state to PAUSED"),d.value="PAUSED",A("PAUSED"),W(),rt())};e.addEventListener("touchend",i,{passive:!1}),e.addEventListener("touchcancel",i,{passive:!1}),document.addEventListener("touchend",i),document.addEventListener("touchcancel",i)}function po(){r.x=B-r.width/2,r.y=C-r.height/2,r.dx=0,r.dy=0,console.log("[DEBUG] Player updated to",{x:r.x,y:r.y})}function go(){const e=document.getElementById("gameCanvas"),t=document.getElementById("startButton"),o=document.getElementById("restartButton"),i=document.getElementById("continueButton"),n=document.getElementById("quitButton"),s=document.getElementById("startOverlay"),l=document.getElementById("pauseOverlay"),u=document.getElementById("starfieldCanvas");!g&&u&&At(u),Qe(e),tt(e),so(e),g?(mo(e),s==null||s.addEventListener("touchstart",a=>{a.preventDefault(),d.value==="START"&&(console.log("[DEBUG] Starting game from overlay touch"),v(()=>Promise.resolve().then(()=>S),void 0).then(c=>{c.unlockAudio(),c.startMusic()}),de(e),G())},{passive:!1}),l==null||l.addEventListener("touchstart",a=>{a.preventDefault(),d.value==="PAUSED"&&(console.log("[DEBUG] Resuming game from overlay touch"),d.value="PLAYING",A("PLAYING"),v(()=>Promise.resolve().then(()=>S),void 0).then(c=>c.unmuteAll()),G())},{passive:!1})):fo(e),g||t==null||t.addEventListener("click",()=>{d.value==="START"&&(v(()=>Promise.resolve().then(()=>S),void 0).then(a=>{a.unlockAudio(),a.startMusic()}),de(e),G())}),o==null||o.addEventListener("click",()=>{de(e),G()}),i==null||i.addEventListener("click",()=>{at(),G()}),n==null||n.addEventListener("click",()=>{et()}),A("START")}window.addEventListener("DOMContentLoaded",go);
