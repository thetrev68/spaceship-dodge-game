(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const ct="modulepreload",dt=function(e){return"/spaceship-dodge-game/"+e},ke={},y=function(t,n,i){let o=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),d=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));o=Promise.allSettled(n.map(c=>{if(c=dt(c),c in ke)return;ke[c]=!0;const a=c.endsWith(".css"),f=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${f}`))return;const h=document.createElement("link");if(h.rel=a?"stylesheet":ct,a||(h.as="script"),h.crossOrigin="",h.href=c,d&&h.setAttribute("nonce",d),document.head.appendChild(h),a)return new Promise((g,S)=>{h.addEventListener("load",g),h.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(r){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=r,window.dispatchEvent(d),!d.defaultPrevented)throw r}return o.then(r=>{for(const d of r||[])d.status==="rejected"&&s(d.reason);return t().catch(s)})};function Z(e){const t=new Set,n=new Proxy(e,{set(i,o,s){return i[o]=s,t.forEach(r=>r()),!0}});return n.watch=i=>t.add(i),n}const p="ontouchstart"in window||navigator.maxTouchPoints>0,u=Z({value:"START"}),M=Z({value:0}),_=Z({value:0}),b=Z({value:3}),ze={value:0},ce={value:0},V=Z({value:!0}),w=[],v=[],D=[35,22,12],qe=[20,50,100],Xe=.8,Ke=2.5,ft=.5,ht=10,T=3,mt=100,m={doubleBlaster:{active:!1,timer:0},shield:{active:!1,timer:0}},l={x:380,y:500,width:30,height:45,speed:7,dx:0,dy:0},Ze=p?2400:1500,Je=70,pt=Object.freeze(Object.defineProperty({__proto__:null,ASTEROID_LEVEL_SIZES:D,ASTEROID_SCORE_VALUES:qe,BASE_OBSTACLE_MAX_SPEED:Ke,BASE_OBSTACLE_MIN_SPEED:Xe,BASE_SPAWN_INTERVAL:Ze,SPAWN_INTERVAL_DECREASE_PER_LEVEL:Je,SPEED_INCREASE_PER_LEVEL:ft,allowSpawning:V,bulletRadius:T,bulletSpeed:ht,bullets:w,fireRate:mt,gameLevel:_,gameState:u,isMobile:p,lastObstacleSpawnTime:ze,levelStartTime:ce,obstacles:v,player:l,playerLives:b,powerUps:m,score:M},Symbol.toStringTag,{value:"Module"})),oe=document.getElementById("startOverlay"),ie=document.getElementById("gameOverOverlay"),gt=document.getElementById("finalScore"),se=document.getElementById("levelTransitionOverlay"),le=document.getElementById("pauseOverlay"),vt=document.getElementById("levelUpMessage"),yt=document.getElementById("currentLevelInfo"),Et=document.getElementById("currentScoreInfo"),Ge=document.getElementById("livesInfoStart"),Ue=document.getElementById("livesInfoLevel"),Ve=document.getElementById("livesInfoPause"),Ye=document.getElementById("pauseResumeMessage"),xe=document.getElementById("startHint");function A(e,t=0,n=0){switch([oe,le,ie,se].forEach(o=>{o.classList.add("hidden"),o.classList.remove("flex")}),Ge&&(Ge.textContent=`Lives: ${b.value}`),Ue&&(Ue.textContent=`Lives: ${b.value}`),Ve&&(Ve.textContent=`Lives: ${b.value}`),e){case"START":xe&&(xe.textContent=p?"Touch and Hold the Screen to Begin":"Press SPACE or Left Mouse Click to fire!"),oe.classList.remove("hidden"),oe.classList.add("flex");break;case"GAME_OVER":y(()=>Promise.resolve().then(()=>I),void 0).then(o=>o.stopMusic()),gt.textContent=`Final Score: ${t} (Level ${n+1})`,ie.classList.remove("hidden"),ie.classList.add("flex");break;case"LEVEL_TRANSITION":y(()=>Promise.resolve().then(()=>I),void 0).then(o=>o.stopMusic()),vt.textContent=`LEVEL ${n+1} !`,yt.textContent="Get Ready!",Et.textContent=`Score: ${t}`,se.classList.remove("hidden"),se.classList.add("flex");break;case"PAUSED":y(()=>Promise.resolve().then(()=>I),void 0).then(o=>o.stopMusic()),Ye&&(Ye.textContent=p?"Touch and Hold to Resume":"Press P to Resume"),le.classList.remove("hidden"),le.classList.add("flex");break;case"PLAYING":document.querySelectorAll(".game-overlay").forEach(o=>{o.classList.add("hidden"),o.classList.remove("flex")}),y(()=>Promise.resolve().then(()=>I),void 0).then(o=>o.startMusic());break}document.dispatchEvent(new Event("gameStateChange"))}function Se(e){const t=window.innerWidth,n=window.innerHeight;t<600?(e.width=480,e.height=854,e.style.width="100vw",e.style.height="100vh",e.style.objectFit="contain",e.style.display="block",e.style.backgroundColor="black"):(e.width=t*.9,e.height=n*.9,e.style.width="",e.style.height="",e.style.objectFit="",e.style.backgroundColor="")}function Qe(){confirm("Are you sure you want to quit the game?")&&Promise.all([y(()=>Promise.resolve().then(()=>I),void 0),y(()=>Promise.resolve().then(()=>pt),void 0),y(()=>Promise.resolve().then(()=>et),void 0)]).then(([t,n,i])=>{t.stopMusic(),n.gameState.value="GAME_OVER",n.bullets.length=0,n.obstacles.length=0,Object.keys(n.powerUps).forEach(o=>{n.powerUps[o].active=!1,n.powerUps[o].timer=0}),t.playSound("gameover"),i.showOverlay("GAME_OVER",n.score.value,n.gameLevel.value)})}function _e(e){const t=e.getBoundingClientRect();[oe,ie,se,le].forEach(n=>{n.style.width=t.width+"px",n.style.height=t.height+"px",n.style.left=t.left+"px",n.style.top=t.top+"px"})}const et=Object.freeze(Object.defineProperty({__proto__:null,initializeCanvas:Se,quitGame:Qe,setOverlayDimensions:_e,showOverlay:A},Symbol.toStringTag,{value:"Module"}));function Pt(e){if(p){e.style.display="none";return}const t=e.getContext("2d"),n=[],i=100;function o(){e.width=window.innerWidth,e.height=window.innerHeight,e.style.width="100vw",e.style.height="100vh",e.style.objectFit="cover"}o(),window.addEventListener("resize",o);for(let r=0;r<i;r++)n.push({x:Math.random()*e.width,y:Math.random()*e.height,radius:Math.random()*1.5+.5,speed:Math.random()*.5+.1});function s(){t.clearRect(0,0,e.width,e.height),t.fillStyle="white";for(const r of n)r.y+=r.speed,r.y>e.height&&(r.y=0,r.x=Math.random()*e.width),t.beginPath(),t.arc(r.x,r.y,r.radius,0,2*Math.PI),t.fill();requestAnimationFrame(s)}s()}const H="/spaceship-dodge-game/",wt=/Mobi|Android/i.test(navigator.userAgent),E={bgm:new Audio(`${H}sounds/bg-music.mp3`),fire:`${H}sounds/fire.mp3`,break:`${H}sounds/break.mp3`,gameover:`${H}sounds/gameover.mp3`,levelup:`${H}sounds/levelup.mp3`};let C=.4,P=!1,de=!1;const re={},Lt=wt?4:8;E.bgm.loop=!0;pe();function pe(){E.bgm.volume=P?0:C,E.bgm.muted=P,Object.values(re).flat().forEach(e=>{e.volume=P?0:C,e.muted=P})}function tt(e){C=e,P||pe()}function $(){P=!0,pe()}function F(){P=!1,pe()}function J(e){if(P||!E[e])return;de||Ce();const t=E[e];if(typeof t!="string")return;re[e]||(re[e]=[]);const n=re[e];for(const i of n)if(i.paused||i.ended){i.currentTime=0,i.play().catch(()=>{});return}if(n.length<Lt){const i=new Audio(t);i.volume=C,i.muted=P,i.play().catch(()=>{}),n.push(i)}}function nt(){P||(de||Ce(),setTimeout(()=>{E.bgm.volume=P?0:C,E.bgm.muted=P,E.bgm.play().catch(e=>console.error("Error playing bgm:",e))},100))}function ge(){E.bgm.pause(),E.bgm.currentTime=0}function Ce(){if(de)return;const e=[E.bgm];Object.keys(E).forEach(t=>{if(t==="bgm")return;const n=E[t],i=new Audio(n);i.volume=0,i.play().then(()=>{i.pause(),i.currentTime=0}).catch(()=>{})}),Promise.all(e.map(t=>t.play().then(()=>{t.pause(),t.currentTime=0}).catch(()=>{}))).then(()=>{de=!0})}const I=Object.freeze(Object.defineProperty({__proto__:null,get currentVolume(){return C},muteAll:$,playSound:J,setVolume:tt,startMusic:nt,stopMusic:ge,unlockAudio:Ce,unmuteAll:F},Symbol.toStringTag,{value:"Module"})),Ie=[];let $e=0;const ve=document.createElement("canvas");ve.width=T*2;ve.height=T*2;const ye=ve.getContext("2d");ye.fillStyle="#ffff88";ye.beginPath();ye.arc(T,T,T,0,2*Math.PI);ye.fill();function At(e,t){const n=Ie.length>0?Ie.pop():{};return n.x=e,n.y=t,n.radius=T,n.dy=-10,n}function St(e){Ie.push(e)}function we(e,t){if(u.value!=="PLAYING")return;const n=At(e,t);w.push(n);const i=Date.now(),o=p?120:30;i-$e>o&&(J("fire"),$e=i)}function _t(e){for(let t=w.length-1;t>=0;t--){const n=w[t];n.y+=n.dy,n.y+n.radius<0&&(w.splice(t,1),St(n))}}function It(e){w.forEach(t=>{e.drawImage(ve,t.x-T,t.y-T)})}function Tt(){if(u.value!=="PLAYING")return;l.x+=l.dx,l.y+=l.dy;const e=document.getElementById("gameCanvas");l.x=Math.max(0,Math.min(l.x,e.width-l.width)),l.y=Math.max(0,Math.min(l.y,e.height-l.height))}function bt(e){if(u.value!=="PLAYING")return;if(m.shield.active){e.save(),e.shadowColor="#0ff",e.shadowBlur=20,e.strokeStyle="#00ffff",e.lineWidth=4;const rt=l.x+l.width/2,at=l.y+l.height/2,ut=Math.max(l.width,l.height)*.7;e.beginPath(),e.arc(rt,at,ut,0,Math.PI*2),e.stroke(),e.restore()}e.strokeStyle="#00ffff",e.lineWidth=2;const t=l.width,n=l.height,i=l.x,o=l.y,s=i+t/2,r=.3;e.beginPath(),e.moveTo(s,o),e.lineTo(i+t*.2,o+n*.8),e.lineTo(s-t*r,o+n*.75),e.lineTo(s+t*r,o+n*.75),e.lineTo(i+t*.8,o+n*.8),e.closePath(),e.stroke();const d=t*.2,c=t*.07,a=n*.3,f=o+n*.75,h=f+a,g=s-d/2,S=s+d/2,j=s-c/2,W=s+c/2;e.beginPath(),e.moveTo(g,f),e.lineTo(S,f),e.lineTo(W,h),e.lineTo(j,h),e.closePath(),e.stroke(),e.beginPath(),e.moveTo(s,f+a*.2),e.lineTo(s,f+a*.8),e.moveTo(s-c*.8,f+a*.3),e.lineTo(s-c*.8,f+a*.7),e.moveTo(s+c*.8,f+a*.3),e.lineTo(s+c*.8,f+a*.7),e.stroke();const N=performance.now()/500,k=(Math.sin(N)+1)/2,L=s,Ee=h+5,O=c,Pe=e.createRadialGradient(L,Ee,0,L,Ee,O*3);Pe.addColorStop(0,`rgba(0, 255, 255, ${.6*k})`),Pe.addColorStop(1,"rgba(0, 255, 255, 0)"),e.fillStyle=Pe,e.beginPath(),e.ellipse(L,Ee+O,O*1.5,O*3,0,0,Math.PI*2),e.fill(),e.fillStyle=`rgba(0, 255, 255, ${.7*k})`,e.beginPath(),e.moveTo(L-O*.6,h),e.lineTo(L+O*.6,h),e.lineTo(L,h+O*3),e.closePath(),e.fill()}function Te(){m.doubleBlaster.active?(we(l.x+l.width*.25,l.y),we(l.x+l.width*.75,l.y)):we(l.x+l.width/2,l.y)}const X=[],be=[];function Me(e,t,n,i="#ffffff"){if(p)return;let o;be.length>0?o=be.pop():o={},o.text=e,o.x=t,o.y=n,o.opacity=1,o.color=i,X.push(o)}function Mt(){if(!p)for(let e=X.length-1;e>=0;e--){const t=X[e];t.y-=.5,t.opacity-=.02,t.opacity<=0&&(X.splice(e,1),be.push(t))}}function Ot(e){p||(e.font="16px Inter",X.forEach(t=>{e.globalAlpha=t.opacity,e.fillStyle=t.color,e.fillText(t.text,t.x,t.y)}),e.globalAlpha=1)}let Fe=Xe,Rt=1;const B={};let Bt=Ke;const fe=[];let Ne=0;function Dt(){Ne=0}function Ct(e,t){const n=[],i=Math.PI*2/t;for(let o=0;o<t;o++){const s=o*i,r=e*(.8+Math.random()*.4);n.push({x:r*Math.cos(s),y:r*Math.sin(s)})}return n}function ot(e,t,n,i=0,o=0,s=null){const r=D[n],d=qe[n],c=Math.floor(Math.random()*6)+5,a=p?Math.min(c,5):c,f=Ct(r,a),h=Rt++;s===null&&(B[h]=0);const g=s??h;typeof B[g]>"u"&&(B[g]=0),n===D.length-1&&B[g]++;const S=Math.random()*(Bt-Fe)+Fe,j=s===null?S:S*.3,W=Math.random()*2*Math.PI,N=Math.random()*.01-.05,k=Date.now(),L=fe.length>0?fe.pop():{};Object.assign(L,{x:e,y:t,radius:r,speed:j,dx:i,dy:o,shape:f,level:n,scoreValue:d,id:h,parentId:g,rotation:W,rotationSpeed:N,creationTime:k}),v.push(L),n===0&&Ne++}function Nt(e,t,n,i,o=!0){const s=Date.now(),r=100,d=3e4;for(let c=0;c<v.length;c++){const a=v[c];a.creationTime||(a.creationTime=s),a.y+=a.speed+a.dy,a.x+=a.dx,a.rotation=(a.rotation+a.rotationSpeed)%(2*Math.PI);const f=a.y>t+r||a.x+a.radius*2<-100||a.x>e+r,h=s-a.creationTime>d;if(f||h){const[g]=v.splice(c,1);fe.push(g),c--}}o&&s-i.value>n&&(ot(Math.random()*(e-D[0]*2),-D[0]*2,0),i.value=s)}function kt(e){e.strokeStyle="#ff4500",e.lineWidth=2,v.forEach(t=>{e.save(),e.translate(t.x+t.radius,t.y+t.radius),e.rotate(t.rotation),e.beginPath(),e.moveTo(t.shape[0].x,t.shape[0].y);for(let n=1;n<t.shape.length;n++)e.lineTo(t.shape[n].x,t.shape[n].y);e.closePath(),e.stroke(),e.restore()})}function Gt(e,t){const n=v.indexOf(e);if(n!==-1){if(v.splice(n,1),fe.push(e),J("break"),e.level<D.length-1){const i=e.level+1,o=Math.floor(Math.random()*2)+2;for(let s=0;s<o;s++){const r=Math.random()*Math.PI*2,d=Math.random()<.8?Math.random()*.7+.3:Math.random()*1.5+1,c=Math.cos(r)*d,a=Math.sin(r)*d;ot(e.x+e.radius,e.y+e.radius,i,c,a,e.parentId??e.id)}}t.value+=e.scoreValue,Me(`+${e.scoreValue}`,e.x+e.radius,e.y),e.parentId!==null&&e.level===D.length-1&&(B[e.parentId]--,B[e.parentId]===0&&(t.value+=150,Me("+150 (All Fragments)",e.x,e.y-10,"#00ff00"),delete B[e.parentId]))}}const he={DOUBLE_BLASTER:"doubleBlaster",SHIELD:"shield"},K=50,G=[];function Ut(e){const t=Math.random()*(e-K),n=-50,i=Math.random()<.5?he.DOUBLE_BLASTER:he.SHIELD;G.push({x:t,y:n,size:K,type:i,dy:1.5})}function Vt(e){for(let t=G.length-1;t>=0;t--){const n=G[t];if(n.y+=n.dy,n.y>e){G.splice(t,1);continue}l.x<n.x+n.size&&l.x+l.width>n.x&&l.y<n.y+n.size&&l.y+l.height>n.y&&(xt(n.type),G.splice(t,1),Me(`Power-up! ${n.type}`,l.x,l.y-20,"#00ffff"))}Object.keys(m).forEach(t=>{m[t].active&&(m[t].timer--,m[t].timer<=0&&(m[t].active=!1))})}function Yt(e){const n=performance.now()/600,i=p?.85:(Math.sin(n)+1)/2,o=.75+.5*i;G.forEach(s=>{const r=s.x+K/2,d=s.y+K/2,c=K/2;if(e.save(),e.translate(r,d),e.scale(o,o),e.translate(-r,-d),s.type===he.DOUBLE_BLASTER){const f=c*.8,h=f/2.5;p||(e.shadowColor="#f9d71c",e.shadowBlur=15*i),e.fillStyle="#f9d71c",e.beginPath();for(let g=0;g<5;g++){const S=Math.PI/2*3+g*Math.PI*2/5,j=r+Math.cos(S)*f,W=d+Math.sin(S)*f;e.lineTo(j,W);const N=S+Math.PI/5,k=r+Math.cos(N)*h,L=d+Math.sin(N)*h;e.lineTo(k,L)}e.closePath(),e.fill()}else if(s.type===he.SHIELD){const a=c*(.75+.25*i);if(!p){const f=e.createRadialGradient(r,d,a*.1,r,d,a);f.addColorStop(0,`rgba(0, 255, 255, ${.8*i})`),f.addColorStop(1,"rgba(0, 255, 255, 0)"),e.fillStyle=f,e.beginPath(),e.arc(r,d,a,0,Math.PI*2),e.fill()}e.fillStyle="#0ff",e.beginPath(),e.arc(r,d,a*.6,0,Math.PI*2),e.fill()}e.restore()})}function xt(e){m[e].active=!0,m[e].timer=600}function $t(e,t,n,i,o,s,r){const d=Math.max(i,Math.min(e,i+s)),c=Math.max(o,Math.min(t,o+r)),a=e-d,f=t-c;return a*a+f*f<n*n}function Ft(){const e=l.x,t=l.y,n=l.width,i=l.height;for(const o of v){const s=o.x+o.radius,r=o.y+o.radius;if($t(s,r,o.radius,e,t,n,i))return o}return null}function jt(){for(let e=w.length-1;e>=0;e--){const t=w[e];for(let n=v.length-1;n>=0;n--){const i=v[n],o=t.x-(i.x+i.radius),s=t.y-(i.y+i.radius);if(Math.sqrt(o*o+s*s)<t.radius+i.radius){w.splice(e,1),Gt(i,M);break}}}}function Wt(){Ft()&&(m.shield.active||y(()=>Promise.resolve().then(()=>un),void 0).then(t=>t.handlePlayerHit())),jt()}let z=!1,q=null;const Ht=5e3,zt=20;function Q(){V.value=!0,z=!1,q=null,ce.value=Date.now()}function qt(e){const t=Date.now();if((t-ce.value)/1e3,Ne>=(_.value+1)*zt&&(V.value=!1),!V.value&&!z&&v.length===0&&(z=!0,q=t),z&&q){const n=t-q,i=t-ce.value;(n>=1500||i>=Ht)&&(_.value++,u.value="LEVEL_TRANSITION",w.length=0,V.value=!0,z=!1,q=null,y(()=>Promise.resolve().then(()=>I),void 0).then(o=>o.playSound("levelup")),y(()=>Promise.resolve().then(()=>I),void 0).then(o=>o.stopMusic()),e())}}function Xt(e){e.fillStyle="#ffffff",e.font='24px "Inter", sans-serif',e.textAlign="left",e.fillText(`Score: ${M.value}`,20,40),e.fillText(`Level: ${_.value+1}`,20,70),e.fillText(`Lives: ${b.value}`,20,100)}function Kt(e){let i=120;e.font="18px monospace",e.fillStyle="#00ffff",Object.entries(m).forEach(([o,s])=>{if(s.active){const r=Math.ceil(s.timer/60);e.fillText(`${Zt(o)}: ${r}s`,20,i),i+=24}})}function Zt(e){return e.charAt(0).toUpperCase()+e.slice(1)}function Jt(e){u.value==="PLAYING"&&(e.save(),e.globalAlpha=1,e.fillStyle="white",e.font="16px Inter",bt(e),kt(e),It(e),Yt(e),Xt(e),Ot(e),Kt(e),e.restore())}const Qt=60,en=1e3/Qt;let je=0,Y,U,Oe,Le=0;const tn=1e4,it=300;function nn(e){const t=Ze-e*Je;return Math.max(t,it)}let We=it;function on(e){U=e,U.width=window.innerWidth,U.height=window.innerHeight,Oe=U.getContext("2d")}function x(){U&&(Y=requestAnimationFrame(e=>Re(U,e)))}function Re(e,t=0){if(t-je<en){Y=requestAnimationFrame(n=>Re(e,n));return}if(je=t,u.value!=="PLAYING"){st();return}Oe.clearRect(0,0,e.width,e.height),We=nn(_.value),(!Le||t-Le>tn)&&(Ut(e.width),Le=t),Tt(),Nt(e.width,e.height,We,ze,V.value),_t(e.height),Vt(e.height),Mt(),Wt(),Jt(Oe),qt(()=>{Dt(),Q(),y(()=>Promise.resolve().then(()=>et),void 0).then(n=>{n.showOverlay("LEVEL_TRANSITION",M.value,_.value)})}),Y=requestAnimationFrame(n=>Re(e,n))}function st(){Y&&(cancelAnimationFrame(Y),Y=null)}function sn(){const e=document.createElement("div");e.style.position="absolute",e.style.top="20px",e.style.right="20px",e.style.zIndex="20",e.style.display="flex",e.style.gap="10px";const t=document.createElement("button");t.textContent="🔇",t.addEventListener("touchstart",o=>{o.preventDefault(),$()},{passive:!1}),t.addEventListener("click",()=>$());const n=document.createElement("button");n.textContent="🔊",n.addEventListener("touchstart",o=>{o.preventDefault(),F()},{passive:!1}),n.addEventListener("click",()=>F());const i=document.createElement("input");i.type="range",i.min="0",i.max="1",i.step="0.05",i.value=C.toString(),i.oninput=o=>{const s=parseFloat(o.target.value);tt(s)},e.appendChild(t),e.appendChild(n),e.appendChild(i),document.body.appendChild(e)}function ln(){b.value-=1,J("gameover"),b.value<=0?(u.value="GAME_OVER",ge(),A("GAME_OVER",M.value,_.value)):(u.value="LEVEL_TRANSITION",rn(),A("LEVEL_TRANSITION",M.value,_.value))}function rn(){l.x=window.innerWidth/2-l.width/2,l.y=window.innerHeight-l.height-50,l.dx=0,l.dy=0,w.length=0,v.length=0,Q(),ge()}function me(e){u.value="PLAYING",M.value=0,_.value=0,b.value=3,m.shield.active=!1,m.shield.timer=0,m.doubleBlaster.active=!1,m.doubleBlaster.timer=0,w.length=0,v.length=0,l.x=e.width/2-l.width/2,l.y=e.height-l.height-50,l.dx=0,l.dy=0,Q(),A("PLAYING"),sn(),F(),y(()=>Promise.resolve().then(()=>I),void 0).then(n=>n.startMusic()),e.getContext("2d").clearRect(0,0,e.width,e.height)}function lt(){u.value="PLAYING",Q(),A("PLAYING"),nt()}function an(){u.value="GAME_OVER",ge(),J("gameover"),A("GAME_OVER",M.value,_.value)}const un=Object.freeze(Object.defineProperty({__proto__:null,continueGame:lt,endGame:an,handlePlayerHit:ln,resetLevelFlow:Q,showOverlay:A,startGame:me},Symbol.toStringTag,{value:"Module"}));let ae=!1,ue=null,R=!1,ee=0;const He=150;function cn(e){document.addEventListener("keydown",t=>{if(t.key==="p"&&!R){if(R=!0,u.value!=="PLAYING"&&u.value!=="PAUSED"){R=!1;return}const n=u.value==="PLAYING"?"PAUSED":"PLAYING";u.value=n,A(n),n==="PAUSED"?($(),Ae()):n==="PLAYING"&&(F(),x()),setTimeout(()=>R=!1,300);return}if(u.value==="PLAYING")switch(t.key){case"ArrowUp":case"w":l.dy=-l.speed;break;case"ArrowDown":case"s":l.dy=l.speed;break;case"ArrowLeft":case"a":l.dx=-l.speed;break;case"ArrowRight":case"d":l.dx=l.speed;break;case" ":const n=Date.now();n-ee>He&&(Te(),ee=n);break}}),document.addEventListener("keyup",t=>{if(u.value==="PLAYING")switch(t.key){case"ArrowUp":case"w":case"ArrowDown":case"s":l.dy=0;break;case"ArrowLeft":case"a":case"ArrowRight":case"d":l.dx=0;break}}),e.addEventListener("mousemove",t=>{if(u.value!=="PLAYING")return;const n=e.getBoundingClientRect(),i=t.clientX-n.left,o=t.clientY-n.top;l.x=i-l.width/2,l.y=o-l.height/2}),e.addEventListener("mousedown",t=>{if(u.value!=="PLAYING"||t.button!==0||ae)return;ae=!0;function n(){if(!ae||u.value!=="PLAYING")return;const i=Date.now();i-ee>He&&(Te(),ee=i),ue=setTimeout(n,100)}n()}),e.addEventListener("mouseup",t=>{t.button===0&&Ae()}),e.addEventListener("contextmenu",t=>{if(t.preventDefault(),!R&&(u.value==="PLAYING"||u.value==="PAUSED")){R=!0;const n=u.value==="PLAYING"?"PAUSED":"PLAYING";u.value=n,A(n),n==="PAUSED"?($(),Ae()):n==="PLAYING"&&(F(),x()),setTimeout(()=>R=!1,300)}})}function Ae(){ae=!1,ue&&(clearTimeout(ue),ue=null)}let te=!1,Be=0,De=0,ne=null;function dn(e){ne=e,console.log("[DEBUG] setupMobileInput called"),setInterval(()=>{console.log("[DEBUG] gameState:",u.value)},1e3);function t(){console.log("[DEBUG] mobileLoop tick:",{active:te,state:u.value}),te&&u.value==="PLAYING"&&(fn(),Te()),requestAnimationFrame(t)}requestAnimationFrame(t),e.addEventListener("touchstart",i=>{i.preventDefault();const o=i.touches[0];if(!o)return;const s=ne.getBoundingClientRect();Be=o.clientX-s.left,De=o.clientY-s.top,te=!0,console.log("[DEBUG] TOUCH START"),(u.value==="START"||u.value==="PAUSED")&&(console.log("[DEBUG] Starting game from touch"),me(ne),x())},{passive:!1}),e.addEventListener("touchmove",i=>{i.preventDefault();const o=i.touches[0];if(!o)return;const s=ne.getBoundingClientRect();Be=o.clientX-s.left,De=o.clientY-s.top},{passive:!1});const n=()=>{console.log("[DEBUG] TOUCH END"),te=!1,u.value==="PLAYING"&&(console.log("[DEBUG] Switching state to PAUSED"),u.value="PAUSED",A("PAUSED"),$(),st())};e.addEventListener("touchend",n,{passive:!1}),e.addEventListener("touchcancel",n,{passive:!1}),document.addEventListener("touchend",n),document.addEventListener("touchcancel",n)}function fn(){l.x=Be-l.width/2,l.y=De-l.height/2}function hn(){const e=document.getElementById("gameCanvas"),t=document.getElementById("startButton"),n=document.getElementById("restartButton"),i=document.getElementById("continueButton"),o=document.getElementById("quitButton"),s=document.getElementById("starfieldCanvas");!p&&s&&Pt(s),Se(e),_e(e),on(e),p?dn(e):cn(e),window.addEventListener("resize",()=>{Se(e),_e(e)}),p||t==null||t.addEventListener("click",()=>{u.value==="START"&&(y(()=>Promise.resolve().then(()=>I),void 0).then(r=>r.unlockAudio()),me(e),x())}),n==null||n.addEventListener("click",()=>{me(e),x()}),i==null||i.addEventListener("click",()=>{lt(),x()}),o==null||o.addEventListener("click",()=>{Qe()}),A("START")}window.addEventListener("DOMContentLoaded",hn);
