(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const gt="modulepreload",vt=function(e){return"/spaceship-dodge-game/"+e},Be={},v=function(t,n,o){let i=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),c=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));i=Promise.allSettled(n.map(u=>{if(u=vt(u),u in Be)return;Be[u]=!0;const a=u.endsWith(".css"),h=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${h}`))return;const f=document.createElement("link");if(f.rel=a?"stylesheet":gt,a||(f.as="script"),f.crossOrigin="",f.href=u,c&&f.setAttribute("nonce",c),document.head.appendChild(f),a)return new Promise((m,w)=>{f.addEventListener("load",m),f.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${u}`)))})}))}function s(r){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=r,window.dispatchEvent(c),!c.defaultPrevented)throw r}return i.then(r=>{for(const c of r||[])c.status==="rejected"&&s(c.reason);return t().catch(s)})};function ee(e){const t=new Set,n=new Proxy(e,{set(o,i,s){return o[i]=s,t.forEach(r=>r()),!0}});return n.watch=o=>t.add(o),n}const p="ontouchstart"in window||navigator.maxTouchPoints>0,d=ee({value:"START"}),R=ee({value:0}),I=ee({value:0}),M=ee({value:3}),ze={value:0},ce={value:0},x=ee({value:!0}),A=[],y=[],U=[35,22,12],Xe=[20,50,100],Ke=.8,Ze=2.5,Et=.5,yt=10,T=3,Pt=100,g={doubleBlaster:{active:!1,timer:0},shield:{active:!1,timer:0}},l={x:380,y:500,width:30,height:45,speed:7,dx:0,dy:0},Je=p?2400:1500,Qe=70,wt=Object.freeze(Object.defineProperty({__proto__:null,ASTEROID_LEVEL_SIZES:U,ASTEROID_SCORE_VALUES:Xe,BASE_OBSTACLE_MAX_SPEED:Ze,BASE_OBSTACLE_MIN_SPEED:Ke,BASE_SPAWN_INTERVAL:Je,SPAWN_INTERVAL_DECREASE_PER_LEVEL:Qe,SPEED_INCREASE_PER_LEVEL:Et,allowSpawning:x,bulletRadius:T,bulletSpeed:yt,bullets:A,fireRate:Pt,gameLevel:I,gameState:d,isMobile:p,lastObstacleSpawnTime:ze,levelStartTime:ce,obstacles:y,player:l,playerLives:M,powerUps:g,score:R},Symbol.toStringTag,{value:"Module"})),et=document.getElementById("startOverlay"),tt=document.getElementById("gameOverOverlay"),At=document.getElementById("finalScore"),nt=document.getElementById("levelTransitionOverlay"),ot=document.getElementById("pauseOverlay"),Lt=document.getElementById("levelUpMessage"),St=document.getElementById("currentLevelInfo"),_t=document.getElementById("currentScoreInfo"),De=document.getElementById("livesInfoStart"),Ge=document.getElementById("livesInfoLevel"),Ue=document.getElementById("livesInfoPause"),Ce=document.getElementById("pauseResumeMessage"),ke=document.getElementById("startHint"),Ne=document.getElementById("tapToContinueMobile"),Ve=document.getElementById("continueButton"),Ye=document.getElementById("startButton"),xe=document.getElementById("quitButton");function It(){document.querySelectorAll(".game-overlay").forEach(e=>{e.classList.remove("visible")})}function oe(e){e.classList.add("visible")}function L(e,t=0,n=0){switch(It(),De&&(De.textContent=`Lives: ${M.value}`),Ge&&(Ge.textContent=`Lives: ${M.value}`),Ue&&(Ue.textContent=`Lives: ${M.value}`),Ye&&(Ye.style.display=p?"none":"block"),Ve&&(Ve.style.display=p?"none":"block"),xe&&(xe.style.display=p?"none":"block"),Ne&&(Ne.style.display=p?"block":"none"),e){case"START":ke&&(ke.textContent=p?"Tap the Screen to Begin":"Press SPACE or Left Mouse Click to fire!"),oe(et);break;case"GAME_OVER":v(()=>Promise.resolve().then(()=>_),void 0).then(o=>o.stopMusic()),At.textContent=`Final Score: ${t} (Level ${n+1})`,oe(tt);break;case"LEVEL_TRANSITION":v(()=>Promise.resolve().then(()=>_),void 0).then(o=>o.stopMusic()),Lt.textContent=`LEVEL ${n+1} !`,St.textContent="Get Ready!",_t.textContent=`Score: ${t}`,oe(nt);break;case"PAUSED":v(()=>Promise.resolve().then(()=>_),void 0).then(o=>o.stopMusic()),Ce&&(Ce.textContent=p?"Tap to Resume":"Press P to Resume"),oe(ot);break;case"PLAYING":v(()=>Promise.resolve().then(()=>_),void 0).then(o=>o.startMusic());break}document.dispatchEvent(new Event("gameStateChange"))}function it(e){const t=window.innerWidth,n=window.innerHeight;t<600?(e.width=480,e.height=854,e.style.width="100vw",e.style.height="100vh",e.style.objectFit="contain"):(e.width=t,e.height=n,e.style.width=t+"px",e.style.height=n+"px",e.style.objectFit="contain"),e.style.display="block",e.style.backgroundColor="black"}function lt(){confirm("Are you sure you want to quit the game?")&&Promise.all([v(()=>Promise.resolve().then(()=>_),void 0),v(()=>Promise.resolve().then(()=>wt),void 0),v(()=>Promise.resolve().then(()=>rt),void 0)]).then(([t,n,o])=>{t.stopMusic(),n.gameState.value="GAME_OVER",n.bullets.length=0,n.obstacles.length=0,Object.keys(n.powerUps).forEach(i=>{n.powerUps[i].active=!1,n.powerUps[i].timer=0}),t.playSound("gameover"),o.showOverlay("GAME_OVER",n.score.value,n.gameLevel.value)})}function st(e){const t=e.getBoundingClientRect();[et,tt,nt,ot].forEach(n=>{n.style.width=t.width+"px",n.style.height=t.height+"px",n.style.left=t.left+"px",n.style.top=t.top+"px"})}const rt=Object.freeze(Object.defineProperty({__proto__:null,initializeCanvas:it,quitGame:lt,setOverlayDimensions:st,showOverlay:L},Symbol.toStringTag,{value:"Module"}));function Tt(e){if(p){e.style.display="none";return}const t=e.getContext("2d"),n=[],o=100;function i(){e.width=window.innerWidth,e.height=window.innerHeight,e.style.width="100vw",e.style.height="100vh",e.style.objectFit="cover"}i(),window.addEventListener("resize",i);for(let r=0;r<o;r++)n.push({x:Math.random()*e.width,y:Math.random()*e.height,radius:Math.random()*1.5+.5,speed:Math.random()*.5+.1});function s(){t.clearRect(0,0,e.width,e.height),t.fillStyle="white";for(const r of n)r.y+=r.speed,r.y>e.height&&(r.y=0,r.x=Math.random()*e.width),t.beginPath(),t.arc(r.x,r.y,r.radius,0,2*Math.PI),t.fill();requestAnimationFrame(s)}s()}const N="/spaceship-dodge-game/";console.log("[DEBUG] soundManager BASE_URL",N);const bt=/Mobi|Android/i.test(navigator.userAgent),E={bgm:new Audio(`${N}sounds/bg-music.mp3`),fire:`${N}sounds/fire.mp3`,break:`${N}sounds/break.mp3`,gameover:`${N}sounds/gameover.mp3`,levelup:`${N}sounds/levelup.mp3`};Object.values(E).forEach((e,t)=>{typeof e!="string"&&(e.addEventListener("error",()=>{console.error("[ERROR] Audio load failed:",Object.keys(E)[t])}),e.addEventListener("loadeddata",()=>{console.log("[DEBUG] Audio loaded:",Object.keys(E)[t])}),e.load())});let b=.4,P=!1,Q=!1;const se={},Ot=bt?4:8;E.bgm.loop=!0;he();function he(){console.log("[DEBUG] applyVolumeAndMute",{isMuted:P,currentVolume:b}),E.bgm.volume=P?0:b,E.bgm.muted=P,Object.values(se).flat().forEach(e=>{e.volume=P?0:b,e.muted=P})}function at(e){b=e,console.log("[DEBUG] setVolume",{currentVolume:e}),P||he()}function F(){console.log("[DEBUG] muteAll called"),P=!0,he()}function j(){console.log("[DEBUG] unmuteAll called"),P=!1,he(),Me()}function te(e){if(console.log("[DEBUG] playSound",{name:e}),P||!E[e])return;Q||ut();const t=E[e];if(typeof t!="string")return;se[e]||(se[e]=[]);const n=se[e];for(const o of n)if(o.paused||o.ended){o.currentTime=0,o.play().catch(i=>console.error("[ERROR] playSound failed:",i));return}if(n.length<Ot){const o=new Audio(t);o.volume=b,o.muted=P,o.play().catch(i=>console.error("[ERROR] playSound new audio failed:",i)),n.push(o)}}function Me(){console.log("[DEBUG] startMusic called",{isAudioUnlocked:Q,isMuted:P}),!(P||!Q)&&(E.bgm.currentTime=0,E.bgm.volume=b,E.bgm.muted=P,E.bgm.play().catch(e=>console.error("[ERROR] startMusic failed:",e)))}function me(){console.log("[DEBUG] stopMusic called"),E.bgm.pause(),E.bgm.currentTime=0}function ut(){return console.log("[DEBUG] unlockAudio called"),new Promise((e,t)=>{if(Q)return e();try{const n=E.bgm;n.volume=.001,n.play().then(()=>{n.pause(),n.currentTime=0,n.volume=b,Q=!0,console.log("[DEBUG] Audio context unlocked"),e()}).catch(o=>{console.error("[ERROR] Unlock audio failed:",o),t(o)})}catch(n){console.error("[ERROR] unlockAudio exception:",n),t(n)}})}const _=Object.freeze(Object.defineProperty({__proto__:null,get currentVolume(){return b},muteAll:F,playSound:te,setVolume:at,startMusic:Me,stopMusic:me,unlockAudio:ut,unmuteAll:j},Symbol.toStringTag,{value:"Module"})),Le=[];let $e=0;const pe=document.createElement("canvas");pe.width=T*2;pe.height=T*2;const ge=pe.getContext("2d");ge.fillStyle="#ffff88";ge.beginPath();ge.arc(T,T,T,0,2*Math.PI);ge.fill();function Mt(e,t){const n=Le.length>0?Le.pop():{};return n.x=e,n.y=t,n.radius=T,n.dy=-10,n}function Rt(e){Le.push(e)}function ye(e,t){if(d.value!=="PLAYING")return;const n=Mt(e,t);A.push(n);const o=Date.now(),i=p?250:30;o-$e>i&&(te("fire"),$e=o)}function Bt(e){for(let t=A.length-1;t>=0;t--){const n=A[t];n.y+=n.dy,n.y+n.radius<0&&(A.splice(t,1),Rt(n))}}function Dt(e){A.forEach(t=>{e.drawImage(pe,t.x-T,t.y-T)})}function Gt(){if(d.value!=="PLAYING")return;l.overridePosition?(l.x=l.overridePosition.x,l.y=l.overridePosition.y,l.overridePosition=null):(l.x+=l.dx,l.y+=l.dy);const e=document.getElementById("gameCanvas");l.x=Math.max(0,Math.min(l.x,e.width-l.width)),l.y=Math.max(0,Math.min(l.y,e.height-l.height))}function Ut(e){if(d.value!=="PLAYING")return;if(g.shield.active){e.save(),e.shadowColor="#0ff",e.shadowBlur=20,e.strokeStyle="#00ffff",e.lineWidth=4;const ht=l.x+l.width/2,mt=l.y+l.height/2,pt=Math.max(l.width,l.height)*.7;e.beginPath(),e.arc(ht,mt,pt,0,Math.PI*2),e.stroke(),e.restore()}e.strokeStyle="#00ffff",e.lineWidth=2;const t=l.width,n=l.height,o=l.x,i=l.y,s=o+t/2,r=.3;e.beginPath(),e.moveTo(s,i),e.lineTo(o+t*.2,i+n*.8),e.lineTo(s-t*r,i+n*.75),e.lineTo(s+t*r,i+n*.75),e.lineTo(o+t*.8,i+n*.8),e.closePath(),e.stroke();const c=t*.2,u=t*.07,a=n*.3,h=i+n*.75,f=h+a,m=s-c/2,w=s+c/2,W=s-u/2,H=s+u/2;e.beginPath(),e.moveTo(m,h),e.lineTo(w,h),e.lineTo(H,f),e.lineTo(W,f),e.closePath(),e.stroke(),e.beginPath(),e.moveTo(s,h+a*.2),e.lineTo(s,h+a*.8),e.moveTo(s-u*.8,h+a*.3),e.lineTo(s-u*.8,h+a*.7),e.moveTo(s+u*.8,h+a*.3),e.lineTo(s+u*.8,h+a*.7),e.stroke();const C=performance.now()/500,k=(Math.sin(C)+1)/2,S=s,ve=f+5,B=u,Ee=e.createRadialGradient(S,ve,0,S,ve,B*3);Ee.addColorStop(0,`rgba(0, 255, 255, ${.6*k})`),Ee.addColorStop(1,"rgba(0, 255, 255, 0)"),e.fillStyle=Ee,e.beginPath(),e.ellipse(S,ve+B,B*1.5,B*3,0,0,Math.PI*2),e.fill(),e.fillStyle=`rgba(0, 255, 255, ${.7*k})`,e.beginPath(),e.moveTo(S-B*.6,f),e.lineTo(S+B*.6,f),e.lineTo(S,f+B*3),e.closePath(),e.fill()}function Se(){g.doubleBlaster.active?(ye(l.x+l.width*.25,l.y),ye(l.x+l.width*.75,l.y)):ye(l.x+l.width/2,l.y)}const Z=[],_e=[];function Ie(e,t,n,o="#ffffff"){if(p)return;let i;_e.length>0?i=_e.pop():i={},i.text=e,i.x=t,i.y=n,i.opacity=1,i.color=o,Z.push(i)}function Ct(){if(!p)for(let e=Z.length-1;e>=0;e--){const t=Z[e];t.y-=.5,t.opacity-=.02,t.opacity<=0&&(Z.splice(e,1),_e.push(t))}}function kt(e){p||(e.font="16px Inter",Z.forEach(t=>{e.globalAlpha=t.opacity,e.fillStyle=t.color,e.fillText(t.text,t.x,t.y)}),e.globalAlpha=1)}let Fe=Ke,Nt=1;const G={};let Vt=Ze;const de=[];let Re=0;function Yt(){Re=0}function xt(e,t){const n=[],o=Math.PI*2/t;for(let i=0;i<t;i++){const s=i*o,r=e*(.8+Math.random()*.4);n.push({x:r*Math.cos(s),y:r*Math.sin(s)})}return n}function ct(e,t,n,o=0,i=0,s=null){const r=U[n],c=Xe[n],u=Math.floor(Math.random()*6)+5,a=p?Math.min(u,5):u,h=xt(r,a),f=Nt++;s===null&&(G[f]=0);const m=s??f;typeof G[m]>"u"&&(G[m]=0),n===U.length-1&&G[m]++;const w=Math.random()*(Vt-Fe)+Fe,W=s===null?w:w*.3,H=Math.random()*2*Math.PI,C=Math.random()*.01-.05,k=Date.now(),S=de.length>0?de.pop():{};Object.assign(S,{x:e,y:t,radius:r,speed:W,dx:o,dy:i,shape:h,level:n,scoreValue:c,id:f,parentId:m,rotation:H,rotationSpeed:C,creationTime:k}),y.push(S),n===0&&Re++}function $t(e,t,n,o,i=!0){const s=Date.now(),r=100,c=3e4;for(let u=0;u<y.length;u++){const a=y[u];a.creationTime||(a.creationTime=s),a.y+=a.speed+a.dy,a.x+=a.dx,a.rotation=(a.rotation+a.rotationSpeed)%(2*Math.PI);const h=a.y>t+r||a.x+a.radius*2<-100||a.x>e+r,f=s-a.creationTime>c;if(h||f){const[m]=y.splice(u,1);de.push(m),u--}}i&&s-o.value>n&&(ct(Math.random()*(e-U[0]*2),-U[0]*2,0),o.value=s)}function Ft(e){e.strokeStyle="#ff4500",e.lineWidth=2,y.forEach(t=>{e.save(),e.translate(t.x+t.radius,t.y+t.radius),e.rotate(t.rotation),e.beginPath(),e.moveTo(t.shape[0].x,t.shape[0].y);for(let n=1;n<t.shape.length;n++)e.lineTo(t.shape[n].x,t.shape[n].y);e.closePath(),e.stroke(),e.restore()})}function jt(e,t){const n=y.indexOf(e);if(n!==-1){if(y.splice(n,1),de.push(e),te("break"),e.level<U.length-1){const o=e.level+1,i=Math.floor(Math.random()*2)+2;for(let s=0;s<i;s++){const r=Math.random()*Math.PI*2,c=Math.random()<.8?Math.random()*.7+.3:Math.random()*1.5+1,u=Math.cos(r)*c,a=Math.sin(r)*c;ct(e.x+e.radius,e.y+e.radius,o,u,a,e.parentId??e.id)}}t.value+=e.scoreValue,Ie(`+${e.scoreValue}`,e.x+e.radius,e.y),e.parentId!==null&&e.level===U.length-1&&(G[e.parentId]--,G[e.parentId]===0&&(t.value+=150,Ie("+150 (All Fragments)",e.x,e.y-10,"#00ff00"),delete G[e.parentId]))}}const fe={DOUBLE_BLASTER:"doubleBlaster",SHIELD:"shield"},J=50,V=[];function Wt(e){const t=Math.random()*(e-J),n=-50,o=Math.random()<.5?fe.DOUBLE_BLASTER:fe.SHIELD;V.push({x:t,y:n,size:J,type:o,dy:1.5})}function Ht(e){for(let t=V.length-1;t>=0;t--){const n=V[t];if(n.y+=n.dy,n.y>e){V.splice(t,1);continue}l.x<n.x+n.size&&l.x+l.width>n.x&&l.y<n.y+n.size&&l.y+l.height>n.y&&(zt(n.type),V.splice(t,1),Ie(`Power-up! ${n.type}`,l.x,l.y-20,"#00ffff"))}Object.keys(g).forEach(t=>{g[t].active&&(g[t].timer--,g[t].timer<=0&&(g[t].active=!1))})}function qt(e){const n=performance.now()/600,o=p?.85:(Math.sin(n)+1)/2,i=.75+.5*o;V.forEach(s=>{const r=s.x+J/2,c=s.y+J/2,u=J/2;if(e.save(),e.translate(r,c),e.scale(i,i),e.translate(-r,-c),s.type===fe.DOUBLE_BLASTER){const h=u*.8,f=h/2.5;p||(e.shadowColor="#f9d71c",e.shadowBlur=15*o),e.fillStyle="#f9d71c",e.beginPath();for(let m=0;m<5;m++){const w=Math.PI/2*3+m*Math.PI*2/5,W=r+Math.cos(w)*h,H=c+Math.sin(w)*h;e.lineTo(W,H);const C=w+Math.PI/5,k=r+Math.cos(C)*f,S=c+Math.sin(C)*f;e.lineTo(k,S)}e.closePath(),e.fill()}else if(s.type===fe.SHIELD){const a=u*(.75+.25*o);if(!p){const h=e.createRadialGradient(r,c,a*.1,r,c,a);h.addColorStop(0,`rgba(0, 255, 255, ${.8*o})`),h.addColorStop(1,"rgba(0, 255, 255, 0)"),e.fillStyle=h,e.beginPath(),e.arc(r,c,a,0,Math.PI*2),e.fill()}e.fillStyle="#0ff",e.beginPath(),e.arc(r,c,a*.6,0,Math.PI*2),e.fill()}e.restore()})}function zt(e){g[e].active=!0,g[e].timer=600}function Xt(e,t,n,o,i,s,r){const c=Math.max(o,Math.min(e,o+s)),u=Math.max(i,Math.min(t,i+r)),a=e-c,h=t-u;return a*a+h*h<n*n}function Kt(){const e=l.x,t=l.y,n=l.width,o=l.height;for(const i of y){const s=i.x+i.radius,r=i.y+i.radius;if(Xt(s,r,i.radius,e,t,n,o))return i}return null}function Zt(){for(let e=A.length-1;e>=0;e--){const t=A[e];for(let n=y.length-1;n>=0;n--){const o=y[n],i=t.x-(o.x+o.radius),s=t.y-(o.y+o.radius);if(Math.sqrt(i*i+s*s)<t.radius+o.radius){A.splice(e,1),jt(o,R);break}}}}function Jt(){Kt()&&(g.shield.active||v(()=>Promise.resolve().then(()=>gn),void 0).then(t=>t.handlePlayerHit())),Zt()}let q=!1,z=null;const Qt=5e3,en=20;function ne(){x.value=!0,q=!1,z=null,ce.value=Date.now()}function tn(e){const t=Date.now();if((t-ce.value)/1e3,Re>=(I.value+1)*en&&(x.value=!1),!x.value&&!q&&y.length===0&&(q=!0,z=t),q&&z){const n=t-z,o=t-ce.value;(n>=1500||o>=Qt)&&(I.value++,d.value="LEVEL_TRANSITION",A.length=0,x.value=!0,q=!1,z=null,v(()=>Promise.resolve().then(()=>_),void 0).then(i=>i.playSound("levelup")),v(()=>Promise.resolve().then(()=>_),void 0).then(i=>i.stopMusic()),e())}}function nn(e){e.fillStyle="#ffffff",e.font='24px "Inter", sans-serif',e.textAlign="left",e.fillText(`Score: ${R.value}`,20,40),e.fillText(`Level: ${I.value+1}`,20,70),e.fillText(`Lives: ${M.value}`,20,100)}function on(e){let o=120;e.font="18px monospace",e.fillStyle="#00ffff",Object.entries(g).forEach(([i,s])=>{if(s.active){const r=Math.ceil(s.timer/60);e.fillText(`${ln(i)}: ${r}s`,20,o),o+=24}})}function ln(e){return e.charAt(0).toUpperCase()+e.slice(1)}function sn(e){d.value==="PLAYING"&&(e.save(),e.globalAlpha=1,e.fillStyle="white",e.font="16px Inter",Ut(e),Ft(e),Dt(e),qt(e),nn(e),kt(e),on(e),e.restore())}const rn=60,an=1e3/rn;let je=0,$,Y,Te,Pe=0;const un=1e4,dt=300;function cn(e){const t=Je-e*Qe;return Math.max(t,dt)}let We=dt;function dn(e){Y=e,Y.width=window.innerWidth,Y.height=window.innerHeight,Te=Y.getContext("2d")}function O(){Y&&($=requestAnimationFrame(e=>be(Y,e)))}function be(e,t=0){if(t-je<an){$=requestAnimationFrame(n=>be(e,n));return}if(je=t,d.value!=="PLAYING"){ft();return}Te.clearRect(0,0,e.width,e.height),We=cn(I.value),(!Pe||t-Pe>un)&&(Wt(e.width),Pe=t),Gt(),$t(e.width,e.height,We,ze,x.value),Bt(e.height),Ht(e.height),Ct(),Jt(),sn(Te),tn(()=>{Yt(),ne(),v(()=>Promise.resolve().then(()=>rt),void 0).then(n=>{n.showOverlay("LEVEL_TRANSITION",R.value,I.value)})}),$=requestAnimationFrame(n=>be(e,n))}function ft(){$&&(cancelAnimationFrame($),$=null)}function fn(){const e=document.createElement("div");e.style.position="absolute",e.style.top="20px",e.style.right="20px",e.style.zIndex="20",e.style.display="flex",e.style.gap="10px";const t=document.createElement("button");t.textContent="🔇",t.addEventListener("touchstart",i=>{i.preventDefault(),F()},{passive:!1}),t.addEventListener("click",()=>F());const n=document.createElement("button");n.textContent="🔊",n.addEventListener("touchstart",i=>{i.preventDefault(),j()},{passive:!1}),n.addEventListener("click",()=>j());const o=document.createElement("input");o.type="range",o.min="0",o.max="1",o.step="0.05",o.value=b.toString(),o.oninput=i=>{const s=parseFloat(i.target.value);at(s)},e.appendChild(t),e.appendChild(n),e.appendChild(o),document.body.appendChild(e)}function hn(){M.value-=1,te("gameover"),M.value<=0?(d.value="GAME_OVER",me(),L("GAME_OVER",R.value,I.value)):(d.value="LEVEL_TRANSITION",mn(),L("LEVEL_TRANSITION",R.value,I.value))}function mn(){l.x=window.innerWidth/2-l.width/2,l.y=window.innerHeight-l.height-50,l.dx=0,l.dy=0,A.length=0,y.length=0,ne(),me()}function re(e){d.value="PLAYING",R.value=0,I.value=0,M.value=3,g.shield.active=!1,g.shield.timer=0,g.doubleBlaster.active=!1,g.doubleBlaster.timer=0,A.length=0,y.length=0,l.x=e.width/2-l.width/2,l.y=e.height-l.height-50,l.dx=0,l.dy=0,ne(),L("PLAYING"),fn(),j(),v(()=>Promise.resolve().then(()=>_),void 0).then(n=>n.startMusic()),e.getContext("2d").clearRect(0,0,e.width,e.height)}function Oe(){d.value="PLAYING",ne(),L("PLAYING"),Me()}function pn(){d.value="GAME_OVER",me(),te("gameover"),L("GAME_OVER",R.value,I.value)}const gn=Object.freeze(Object.defineProperty({__proto__:null,continueGame:Oe,endGame:pn,handlePlayerHit:hn,resetLevelFlow:ne,showOverlay:L,startGame:re},Symbol.toStringTag,{value:"Module"}));let ae=!1,ue=null,D=!1,ie=0;const He=150;function vn(e){document.addEventListener("keydown",t=>{if(t.key==="p"&&!D){if(D=!0,d.value!=="PLAYING"&&d.value!=="PAUSED"){D=!1;return}const n=d.value==="PLAYING"?"PAUSED":"PLAYING";d.value=n,L(n),n==="PAUSED"?(F(),we()):n==="PLAYING"&&(j(),O()),setTimeout(()=>D=!1,300);return}if(d.value==="PLAYING")switch(t.key){case"ArrowUp":case"w":l.dy=-l.speed;break;case"ArrowDown":case"s":l.dy=l.speed;break;case"ArrowLeft":case"a":l.dx=-l.speed;break;case"ArrowRight":case"d":l.dx=l.speed;break;case" ":const n=Date.now();n-ie>He&&(Se(),ie=n);break}}),document.addEventListener("keyup",t=>{if(d.value==="PLAYING")switch(t.key){case"ArrowUp":case"w":case"ArrowDown":case"s":l.dy=0;break;case"ArrowLeft":case"a":case"ArrowRight":case"d":l.dx=0;break}}),e.addEventListener("mousemove",t=>{if(d.value!=="PLAYING")return;const n=e.getBoundingClientRect(),o=t.clientX-n.left,i=t.clientY-n.top;l.x=o-l.width/2,l.y=i-l.height/2}),e.addEventListener("mousedown",t=>{if(d.value!=="PLAYING"||t.button!==0||ae)return;ae=!0;function n(){if(!ae||d.value!=="PLAYING")return;const o=Date.now();o-ie>He&&(Se(),ie=o),ue=setTimeout(n,100)}n()}),e.addEventListener("mouseup",t=>{t.button===0&&we()}),e.addEventListener("contextmenu",t=>{if(t.preventDefault(),!D&&(d.value==="PLAYING"||d.value==="PAUSED")){D=!0;const n=d.value==="PLAYING"?"PAUSED":"PLAYING";d.value=n,L(n),n==="PAUSED"?(F(),we()):n==="PLAYING"&&(j(),O()),setTimeout(()=>D=!1,300)}})}function we(){ae=!1,ue&&(clearTimeout(ue),ue=null)}let le=!1,X=0,K=0,Ae=null,qe=0;const En=250;function yn(e){Ae=e,console.log("[DEBUG] setupMobileInput called",{canvasId:e.id});function t(){if(le&&d.value==="PLAYING"){Pn();const o=performance.now();o-qe>=En&&(Se(),qe=o,console.log("[DEBUG] Autofire triggered"))}requestAnimationFrame(t)}requestAnimationFrame(t);function n(o){o.preventDefault(),console.log("[DEBUG] Raw handleTouchStart fired",{target:o.target});const i=o.touches[0];if(!i)return;const s=Ae.getBoundingClientRect();if(X=i.clientX-s.left,K=i.clientY-s.top,le=!0,console.log("[DEBUG] TOUCH START",{touchX:X,touchY:K,state:d.value}),o.target.closest(".game-overlay")||o.target.tagName==="BUTTON"){console.log("[DEBUG] Touch blocked by overlay or button");return}}e.addEventListener("touchstart",n,{passive:!1}),console.log("[DEBUG] Bound touchstart to canvas"),e.addEventListener("touchmove",o=>{o.preventDefault();const i=o.touches[0];if(!i)return;const s=Ae.getBoundingClientRect();X=i.clientX-s.left,K=i.clientY-s.top,console.log("[DEBUG] TOUCH MOVE",{touchX:X,touchY:K})},{passive:!1}),console.log("[DEBUG] Bound touchmove to canvas"),document.addEventListener("touchend",()=>{console.log("[DEBUG] TOUCH END"),le&&(le=!1,d.value==="PLAYING"&&(console.log("[DEBUG] Switching state to PAUSED"),d.value="PAUSED",L("PAUSED"),F(),ft()))},{passive:!1})}function Pn(){l.overridePosition={x:X-l.width/2,y:K-l.height/2},l.dx=0,l.dy=0,console.log("[DEBUG] player.overridePosition set",l.overridePosition)}console.log("[DEBUG] main.js is running");function wn(){console.log("[DEBUG] init running — DOM loaded");const e=document.getElementById("gameCanvas"),t=document.getElementById("startButton"),n=document.getElementById("restartButton"),o=document.getElementById("continueButton"),i=document.getElementById("quitButton"),s=document.getElementById("startOverlay"),r=document.getElementById("pauseOverlay"),c=document.getElementById("levelTransitionOverlay"),u=document.getElementById("starfieldCanvas");if(console.log("[DEBUG] startOverlay element:",s),!s){console.error("[ERROR] startOverlay not found in DOM.");return}!p&&u&&Tt(u),it(e),st(e),dn(e);const a="ontouchstart"in window?"touchstart":"click",h=f=>{f.preventDefault(),d.value==="START"&&(console.log("[DEBUG] Starting game from overlay"),v(()=>Promise.resolve().then(()=>_),void 0).then(m=>{m.unlockAudio().then(()=>{m.unmuteAll(),m.startMusic()}).catch(w=>{console.warn("[WARN] Audio unlock failed:",w)})}),re(e),O())};s.addEventListener(a,h,{passive:!1}),p?(yn(e),r==null||r.addEventListener("touchstart",f=>{f.preventDefault(),d.value==="PAUSED"&&(console.log("[DEBUG] Resuming game from overlay touch"),d.value="PLAYING",L("PLAYING"),v(()=>Promise.resolve().then(()=>_),void 0).then(m=>m.unmuteAll()),O())},{passive:!1}),c==null||c.addEventListener("touchstart",f=>{f.preventDefault(),d.value==="LEVEL_TRANSITION"&&(console.log("[DEBUG] Resuming from level transition overlay"),Oe(),O())},{passive:!1})):(vn(e),t==null||t.addEventListener("click",()=>{d.value==="START"&&v(()=>Promise.resolve().then(()=>_),void 0).then(f=>{f.unlockAudio().then(()=>{f.startMusic(),re(e),O()})})}),o==null||o.addEventListener("click",()=>{Oe(),O()}),i==null||i.addEventListener("click",()=>{lt()})),n==null||n.addEventListener("click",()=>{re(e),O()}),L("START")}window.addEventListener("DOMContentLoaded",wn);
