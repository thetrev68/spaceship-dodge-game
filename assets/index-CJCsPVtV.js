(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const ct="modulepreload",dt=function(e){return"/spaceship-dodge-game/"+e},Ve={},g=function(t,n,i){let o=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),u=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));o=Promise.allSettled(n.map(c=>{if(c=dt(c),c in Ve)return;Ve[c]=!0;const a=c.endsWith(".css"),f=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${f}`))return;const h=document.createElement("link");if(h.rel=a?"stylesheet":ct,a||(h.as="script"),h.crossOrigin="",h.href=c,u&&h.setAttribute("nonce",u),document.head.appendChild(h),a)return new Promise((v,S)=>{h.addEventListener("load",v),h.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(r){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=r,window.dispatchEvent(u),!u.defaultPrevented)throw r}return o.then(r=>{for(const u of r||[])u.status==="rejected"&&s(u.reason);return t().catch(s)})};function Q(e){const t=new Set,n=new Proxy(e,{set(i,o,s){return i[o]=s,t.forEach(r=>r()),!0}});return n.watch=i=>t.add(i),n}const p="ontouchstart"in window||navigator.maxTouchPoints>0,d=Q({value:"START"}),O=Q({value:0}),I=Q({value:0}),M=Q({value:3}),Xe={value:0},de={value:0},x=Q({value:!0}),w=[],y=[],C=[35,22,12],Ke=[20,50,100],Ze=.8,Je=2.5,ft=.5,ht=10,b=3,mt=100,m={doubleBlaster:{active:!1,timer:0},shield:{active:!1,timer:0}},l={x:380,y:500,width:30,height:45,speed:7,dx:0,dy:0},Qe=p?2400:1500,et=70,pt=Object.freeze(Object.defineProperty({__proto__:null,ASTEROID_LEVEL_SIZES:C,ASTEROID_SCORE_VALUES:Ke,BASE_OBSTACLE_MAX_SPEED:Je,BASE_OBSTACLE_MIN_SPEED:Ze,BASE_SPAWN_INTERVAL:Qe,SPAWN_INTERVAL_DECREASE_PER_LEVEL:et,SPEED_INCREASE_PER_LEVEL:ft,allowSpawning:x,bulletRadius:b,bulletSpeed:ht,bullets:w,fireRate:mt,gameLevel:I,gameState:d,isMobile:p,lastObstacleSpawnTime:Xe,levelStartTime:de,obstacles:y,player:l,playerLives:M,powerUps:m,score:O},Symbol.toStringTag,{value:"Module"})),q=document.getElementById("startOverlay"),se=document.getElementById("gameOverOverlay"),vt=document.getElementById("finalScore"),le=document.getElementById("levelTransitionOverlay"),re=document.getElementById("pauseOverlay"),gt=document.getElementById("levelUpMessage"),yt=document.getElementById("currentLevelInfo"),Et=document.getElementById("currentScoreInfo"),Ue=document.getElementById("livesInfoStart"),Ye=document.getElementById("livesInfoLevel"),xe=document.getElementById("livesInfoPause"),$e=document.getElementById("pauseResumeMessage"),Fe=document.getElementById("startHint");function A(e,t=0,n=0){switch([q,re,se,le].forEach(o=>{o.classList.add("hidden"),o.classList.remove("flex")}),Ue&&(Ue.textContent=`Lives: ${M.value}`),Ye&&(Ye.textContent=`Lives: ${M.value}`),xe&&(xe.textContent=`Lives: ${M.value}`),e){case"START":Fe&&(Fe.textContent=p?"Touch and Hold the Screen to Begin":"Press SPACE or Left Mouse Click to fire!"),q.classList.remove("hidden"),q.classList.add("flex");break;case"GAME_OVER":g(()=>Promise.resolve().then(()=>_),void 0).then(o=>o.stopMusic()),vt.textContent=`Final Score: ${t} (Level ${n+1})`,se.classList.remove("hidden"),se.classList.add("flex");break;case"LEVEL_TRANSITION":g(()=>Promise.resolve().then(()=>_),void 0).then(o=>o.stopMusic()),gt.textContent=`LEVEL ${n+1} !`,yt.textContent="Get Ready!",Et.textContent=`Score: ${t}`,le.classList.remove("hidden"),le.classList.add("flex");break;case"PAUSED":g(()=>Promise.resolve().then(()=>_),void 0).then(o=>o.stopMusic()),$e&&($e.textContent=p?"Touch and Hold to Resume":"Press P to Resume"),re.classList.remove("hidden"),re.classList.add("flex");break;case"PLAYING":q.style.display="none",g(()=>Promise.resolve().then(()=>_),void 0).then(o=>o.startMusic());break}document.dispatchEvent(new Event("gameStateChange"))}function Se(e){const t=window.innerWidth,n=window.innerHeight;t<600?(e.width=480,e.height=854,e.style.width="100vw",e.style.height="100vh",e.style.objectFit="contain",e.style.display="block",e.style.backgroundColor="black"):(e.width=t*.9,e.height=n*.9,e.style.width="",e.style.height="",e.style.objectFit="",e.style.backgroundColor="")}function _e(){confirm("Are you sure you want to quit the game?")&&Promise.all([g(()=>Promise.resolve().then(()=>_),void 0),g(()=>Promise.resolve().then(()=>pt),void 0),g(()=>Promise.resolve().then(()=>tt),void 0)]).then(([t,n,i])=>{t.stopMusic(),n.gameState.value="GAME_OVER",n.bullets.length=0,n.obstacles.length=0,Object.keys(n.powerUps).forEach(o=>{n.powerUps[o].active=!1,n.powerUps[o].timer=0}),t.playSound("gameover"),i.showOverlay("GAME_OVER",n.score.value,n.gameLevel.value)})}function Ie(e){const t=e.getBoundingClientRect();[q,se,le,re].forEach(n=>{n.style.width=t.width+"px",n.style.height=t.height+"px",n.style.left=t.left+"px",n.style.top=t.top+"px"})}const tt=Object.freeze(Object.defineProperty({__proto__:null,initializeCanvas:Se,quitGame:_e,setOverlayDimensions:Ie,showOverlay:A},Symbol.toStringTag,{value:"Module"}));function Pt(e){if(p){e.style.display="none";return}const t=e.getContext("2d"),n=[],i=100;function o(){e.width=window.innerWidth,e.height=window.innerHeight,e.style.width="100vw",e.style.height="100vh",e.style.objectFit="cover"}o(),window.addEventListener("resize",o);for(let r=0;r<i;r++)n.push({x:Math.random()*e.width,y:Math.random()*e.height,radius:Math.random()*1.5+.5,speed:Math.random()*.5+.1});function s(){t.clearRect(0,0,e.width,e.height),t.fillStyle="white";for(const r of n)r.y+=r.speed,r.y>e.height&&(r.y=0,r.x=Math.random()*e.width),t.beginPath(),t.arc(r.x,r.y,r.radius,0,2*Math.PI),t.fill();requestAnimationFrame(s)}s()}const z="/spaceship-dodge-game/",wt=/Mobi|Android/i.test(navigator.userAgent),E={bgm:new Audio(`${z}sounds/bg-music.mp3`),fire:`${z}sounds/fire.mp3`,break:`${z}sounds/break.mp3`,gameover:`${z}sounds/gameover.mp3`,levelup:`${z}sounds/levelup.mp3`};let k=.4,P=!1,fe=!1;const ae={},Lt=wt?4:8;E.bgm.loop=!0;pe();function pe(){E.bgm.volume=P?0:k,E.bgm.muted=P,Object.values(ae).flat().forEach(e=>{e.volume=P?0:k,e.muted=P})}function nt(e){k=e,P||pe()}function F(){P=!0,pe()}function j(){P=!1,pe()}function ee(e){if(P||!E[e])return;fe||Ne();const t=E[e];if(typeof t!="string")return;ae[e]||(ae[e]=[]);const n=ae[e];for(const i of n)if(i.paused||i.ended){i.currentTime=0,i.play().catch(()=>{});return}if(n.length<Lt){const i=new Audio(t);i.volume=k,i.muted=P,i.play().catch(()=>{}),n.push(i)}}function ot(){P||(fe||Ne(),setTimeout(()=>{E.bgm.volume=P?0:k,E.bgm.muted=P,E.bgm.play().catch(e=>console.error("Error playing bgm:",e))},100))}function ve(){E.bgm.pause(),E.bgm.currentTime=0}function Ne(){if(fe)return;const e=[E.bgm];Object.keys(E).forEach(t=>{if(t==="bgm")return;const n=E[t],i=new Audio(n);i.volume=0,i.play().then(()=>{i.pause(),i.currentTime=0}).catch(()=>{})}),Promise.all(e.map(t=>t.play().then(()=>{t.pause(),t.currentTime=0}).catch(()=>{}))).then(()=>{fe=!0})}const _=Object.freeze(Object.defineProperty({__proto__:null,get currentVolume(){return k},muteAll:F,playSound:ee,setVolume:nt,startMusic:ot,stopMusic:ve,unlockAudio:Ne,unmuteAll:j},Symbol.toStringTag,{value:"Module"})),Te=[];let je=0;const ge=document.createElement("canvas");ge.width=b*2;ge.height=b*2;const ye=ge.getContext("2d");ye.fillStyle="#ffff88";ye.beginPath();ye.arc(b,b,b,0,2*Math.PI);ye.fill();function At(e,t){const n=Te.length>0?Te.pop():{};return n.x=e,n.y=t,n.radius=b,n.dy=-10,n}function St(e){Te.push(e)}function we(e,t){if(d.value!=="PLAYING")return;const n=At(e,t);w.push(n);const i=Date.now(),o=p?120:30;i-je>o&&(ee("fire"),je=i)}function _t(e){for(let t=w.length-1;t>=0;t--){const n=w[t];n.y+=n.dy,n.y+n.radius<0&&(w.splice(t,1),St(n))}}function It(e){w.forEach(t=>{e.drawImage(ge,t.x-b,t.y-b)})}function Tt(){if(d.value!=="PLAYING")return;l.x+=l.dx,l.y+=l.dy;const e=document.getElementById("gameCanvas");l.x=Math.max(0,Math.min(l.x,e.width-l.width)),l.y=Math.max(0,Math.min(l.y,e.height-l.height))}function bt(e){if(d.value!=="PLAYING")return;if(m.shield.active){e.save(),e.shadowColor="#0ff",e.shadowBlur=20,e.strokeStyle="#00ffff",e.lineWidth=4;const rt=l.x+l.width/2,at=l.y+l.height/2,ut=Math.max(l.width,l.height)*.7;e.beginPath(),e.arc(rt,at,ut,0,Math.PI*2),e.stroke(),e.restore()}e.strokeStyle="#00ffff",e.lineWidth=2;const t=l.width,n=l.height,i=l.x,o=l.y,s=i+t/2,r=.3;e.beginPath(),e.moveTo(s,o),e.lineTo(i+t*.2,o+n*.8),e.lineTo(s-t*r,o+n*.75),e.lineTo(s+t*r,o+n*.75),e.lineTo(i+t*.8,o+n*.8),e.closePath(),e.stroke();const u=t*.2,c=t*.07,a=n*.3,f=o+n*.75,h=f+a,v=s-u/2,S=s+u/2,W=s-c/2,H=s+c/2;e.beginPath(),e.moveTo(v,f),e.lineTo(S,f),e.lineTo(H,h),e.lineTo(W,h),e.closePath(),e.stroke(),e.beginPath(),e.moveTo(s,f+a*.2),e.lineTo(s,f+a*.8),e.moveTo(s-c*.8,f+a*.3),e.lineTo(s-c*.8,f+a*.7),e.moveTo(s+c*.8,f+a*.3),e.lineTo(s+c*.8,f+a*.7),e.stroke();const N=performance.now()/500,G=(Math.sin(N)+1)/2,L=s,Ee=h+5,R=c,Pe=e.createRadialGradient(L,Ee,0,L,Ee,R*3);Pe.addColorStop(0,`rgba(0, 255, 255, ${.6*G})`),Pe.addColorStop(1,"rgba(0, 255, 255, 0)"),e.fillStyle=Pe,e.beginPath(),e.ellipse(L,Ee+R,R*1.5,R*3,0,0,Math.PI*2),e.fill(),e.fillStyle=`rgba(0, 255, 255, ${.7*G})`,e.beginPath(),e.moveTo(L-R*.6,h),e.lineTo(L+R*.6,h),e.lineTo(L,h+R*3),e.closePath(),e.fill()}function be(){m.doubleBlaster.active?(we(l.x+l.width*.25,l.y),we(l.x+l.width*.75,l.y)):we(l.x+l.width/2,l.y)}const Z=[],Me=[];function Oe(e,t,n,i="#ffffff"){if(p)return;let o;Me.length>0?o=Me.pop():o={},o.text=e,o.x=t,o.y=n,o.opacity=1,o.color=i,Z.push(o)}function Mt(){if(!p)for(let e=Z.length-1;e>=0;e--){const t=Z[e];t.y-=.5,t.opacity-=.02,t.opacity<=0&&(Z.splice(e,1),Me.push(t))}}function Ot(e){p||(e.font="16px Inter",Z.forEach(t=>{e.globalAlpha=t.opacity,e.fillStyle=t.color,e.fillText(t.text,t.x,t.y)}),e.globalAlpha=1)}let We=Ze,Rt=1;const D={};let Bt=Je;const he=[];let Ge=0;function Dt(){Ge=0}function Ct(e,t){const n=[],i=Math.PI*2/t;for(let o=0;o<t;o++){const s=o*i,r=e*(.8+Math.random()*.4);n.push({x:r*Math.cos(s),y:r*Math.sin(s)})}return n}function it(e,t,n,i=0,o=0,s=null){const r=C[n],u=Ke[n],c=Math.floor(Math.random()*6)+5,a=p?Math.min(c,5):c,f=Ct(r,a),h=Rt++;s===null&&(D[h]=0);const v=s??h;typeof D[v]>"u"&&(D[v]=0),n===C.length-1&&D[v]++;const S=Math.random()*(Bt-We)+We,W=s===null?S:S*.3,H=Math.random()*2*Math.PI,N=Math.random()*.01-.05,G=Date.now(),L=he.length>0?he.pop():{};Object.assign(L,{x:e,y:t,radius:r,speed:W,dx:i,dy:o,shape:f,level:n,scoreValue:u,id:h,parentId:v,rotation:H,rotationSpeed:N,creationTime:G}),y.push(L),n===0&&Ge++}function kt(e,t,n,i,o=!0){const s=Date.now(),r=100,u=3e4;for(let c=0;c<y.length;c++){const a=y[c];a.creationTime||(a.creationTime=s),a.y+=a.speed+a.dy,a.x+=a.dx,a.rotation=(a.rotation+a.rotationSpeed)%(2*Math.PI);const f=a.y>t+r||a.x+a.radius*2<-100||a.x>e+r,h=s-a.creationTime>u;if(f||h){const[v]=y.splice(c,1);he.push(v),c--}}o&&s-i.value>n&&(it(Math.random()*(e-C[0]*2),-C[0]*2,0),i.value=s)}function Nt(e){e.strokeStyle="#ff4500",e.lineWidth=2,y.forEach(t=>{e.save(),e.translate(t.x+t.radius,t.y+t.radius),e.rotate(t.rotation),e.beginPath(),e.moveTo(t.shape[0].x,t.shape[0].y);for(let n=1;n<t.shape.length;n++)e.lineTo(t.shape[n].x,t.shape[n].y);e.closePath(),e.stroke(),e.restore()})}function Gt(e,t){const n=y.indexOf(e);if(n!==-1){if(y.splice(n,1),he.push(e),ee("break"),e.level<C.length-1){const i=e.level+1,o=Math.floor(Math.random()*2)+2;for(let s=0;s<o;s++){const r=Math.random()*Math.PI*2,u=Math.random()<.8?Math.random()*.7+.3:Math.random()*1.5+1,c=Math.cos(r)*u,a=Math.sin(r)*u;it(e.x+e.radius,e.y+e.radius,i,c,a,e.parentId??e.id)}}t.value+=e.scoreValue,Oe(`+${e.scoreValue}`,e.x+e.radius,e.y),e.parentId!==null&&e.level===C.length-1&&(D[e.parentId]--,D[e.parentId]===0&&(t.value+=150,Oe("+150 (All Fragments)",e.x,e.y-10,"#00ff00"),delete D[e.parentId]))}}const me={DOUBLE_BLASTER:"doubleBlaster",SHIELD:"shield"},J=50,V=[];function Vt(e){const t=Math.random()*(e-J),n=-50,i=Math.random()<.5?me.DOUBLE_BLASTER:me.SHIELD;V.push({x:t,y:n,size:J,type:i,dy:1.5})}function Ut(e){for(let t=V.length-1;t>=0;t--){const n=V[t];if(n.y+=n.dy,n.y>e){V.splice(t,1);continue}l.x<n.x+n.size&&l.x+l.width>n.x&&l.y<n.y+n.size&&l.y+l.height>n.y&&(xt(n.type),V.splice(t,1),Oe(`Power-up! ${n.type}`,l.x,l.y-20,"#00ffff"))}Object.keys(m).forEach(t=>{m[t].active&&(m[t].timer--,m[t].timer<=0&&(m[t].active=!1))})}function Yt(e){const n=performance.now()/600,i=p?.85:(Math.sin(n)+1)/2,o=.75+.5*i;V.forEach(s=>{const r=s.x+J/2,u=s.y+J/2,c=J/2;if(e.save(),e.translate(r,u),e.scale(o,o),e.translate(-r,-u),s.type===me.DOUBLE_BLASTER){const f=c*.8,h=f/2.5;p||(e.shadowColor="#f9d71c",e.shadowBlur=15*i),e.fillStyle="#f9d71c",e.beginPath();for(let v=0;v<5;v++){const S=Math.PI/2*3+v*Math.PI*2/5,W=r+Math.cos(S)*f,H=u+Math.sin(S)*f;e.lineTo(W,H);const N=S+Math.PI/5,G=r+Math.cos(N)*h,L=u+Math.sin(N)*h;e.lineTo(G,L)}e.closePath(),e.fill()}else if(s.type===me.SHIELD){const a=c*(.75+.25*i);if(!p){const f=e.createRadialGradient(r,u,a*.1,r,u,a);f.addColorStop(0,`rgba(0, 255, 255, ${.8*i})`),f.addColorStop(1,"rgba(0, 255, 255, 0)"),e.fillStyle=f,e.beginPath(),e.arc(r,u,a,0,Math.PI*2),e.fill()}e.fillStyle="#0ff",e.beginPath(),e.arc(r,u,a*.6,0,Math.PI*2),e.fill()}e.restore()})}function xt(e){m[e].active=!0,m[e].timer=600}function $t(e,t,n,i,o,s,r){const u=Math.max(i,Math.min(e,i+s)),c=Math.max(o,Math.min(t,o+r)),a=e-u,f=t-c;return a*a+f*f<n*n}function Ft(){const e=l.x,t=l.y,n=l.width,i=l.height;for(const o of y){const s=o.x+o.radius,r=o.y+o.radius;if($t(s,r,o.radius,e,t,n,i))return o}return null}function jt(){for(let e=w.length-1;e>=0;e--){const t=w[e];for(let n=y.length-1;n>=0;n--){const i=y[n],o=t.x-(i.x+i.radius),s=t.y-(i.y+i.radius);if(Math.sqrt(o*o+s*s)<t.radius+i.radius){w.splice(e,1),Gt(i,O);break}}}}function Wt(){Ft()&&(m.shield.active||g(()=>Promise.resolve().then(()=>un),void 0).then(t=>t.handlePlayerHit())),jt()}let X=!1,K=null;const Ht=5e3,zt=20;function te(){x.value=!0,X=!1,K=null,de.value=Date.now()}function qt(e){const t=Date.now();if((t-de.value)/1e3,Ge>=(I.value+1)*zt&&(x.value=!1),!x.value&&!X&&y.length===0&&(X=!0,K=t),X&&K){const n=t-K,i=t-de.value;(n>=1500||i>=Ht)&&(I.value++,d.value="LEVEL_TRANSITION",w.length=0,x.value=!0,X=!1,K=null,g(()=>Promise.resolve().then(()=>_),void 0).then(o=>o.playSound("levelup")),g(()=>Promise.resolve().then(()=>_),void 0).then(o=>o.stopMusic()),e())}}function Xt(e){e.fillStyle="#ffffff",e.font='24px "Inter", sans-serif',e.textAlign="left",e.fillText(`Score: ${O.value}`,20,40),e.fillText(`Level: ${I.value+1}`,20,70),e.fillText(`Lives: ${M.value}`,20,100)}function Kt(e){let i=120;e.font="18px monospace",e.fillStyle="#00ffff",Object.entries(m).forEach(([o,s])=>{if(s.active){const r=Math.ceil(s.timer/60);e.fillText(`${Zt(o)}: ${r}s`,20,i),i+=24}})}function Zt(e){return e.charAt(0).toUpperCase()+e.slice(1)}function Jt(e){d.value==="PLAYING"&&(e.save(),e.globalAlpha=1,e.fillStyle="white",e.font="16px Inter",bt(e),Nt(e),It(e),Yt(e),Xt(e),Ot(e),Kt(e),e.restore())}const Qt=60,en=1e3/Qt;let He=0,$,U,Re,Le=0;const tn=1e4,st=300;function nn(e){const t=Qe-e*et;return Math.max(t,st)}let ze=st;function on(e){U=e,U.width=window.innerWidth,U.height=window.innerHeight,Re=U.getContext("2d")}function T(){U&&($=requestAnimationFrame(e=>Be(U,e)))}function Be(e,t=0){if(t-He<en){$=requestAnimationFrame(n=>Be(e,n));return}if(He=t,d.value!=="PLAYING"){lt();return}Re.clearRect(0,0,e.width,e.height),ze=nn(I.value),(!Le||t-Le>tn)&&(Vt(e.width),Le=t),Tt(),kt(e.width,e.height,ze,Xe,x.value),_t(e.height),Ut(e.height),Mt(),Wt(),Jt(Re),qt(()=>{Dt(),te(),g(()=>Promise.resolve().then(()=>tt),void 0).then(n=>{n.showOverlay("LEVEL_TRANSITION",O.value,I.value)})}),$=requestAnimationFrame(n=>Be(e,n))}function lt(){$&&(cancelAnimationFrame($),$=null)}function sn(){const e=document.createElement("div");e.style.position="absolute",e.style.top="20px",e.style.right="20px",e.style.zIndex="20",e.style.display="flex",e.style.gap="10px";const t=document.createElement("button");t.textContent="🔇",t.addEventListener("touchstart",o=>{o.preventDefault(),F()},{passive:!1}),t.addEventListener("click",()=>F());const n=document.createElement("button");n.textContent="🔊",n.addEventListener("touchstart",o=>{o.preventDefault(),j()},{passive:!1}),n.addEventListener("click",()=>j());const i=document.createElement("input");i.type="range",i.min="0",i.max="1",i.step="0.05",i.value=k.toString(),i.oninput=o=>{const s=parseFloat(o.target.value);nt(s)},e.appendChild(t),e.appendChild(n),e.appendChild(i),document.body.appendChild(e)}function ln(){M.value-=1,ee("gameover"),M.value<=0?(d.value="GAME_OVER",ve(),A("GAME_OVER",O.value,I.value)):(d.value="LEVEL_TRANSITION",rn(),A("LEVEL_TRANSITION",O.value,I.value))}function rn(){l.x=window.innerWidth/2-l.width/2,l.y=window.innerHeight-l.height-50,l.dx=0,l.dy=0,w.length=0,y.length=0,te(),ve()}function Y(e){d.value="PLAYING",O.value=0,I.value=0,M.value=3,m.shield.active=!1,m.shield.timer=0,m.doubleBlaster.active=!1,m.doubleBlaster.timer=0,w.length=0,y.length=0,l.x=e.width/2-l.width/2,l.y=e.height-l.height-50,l.dx=0,l.dy=0,te(),A("PLAYING"),sn(),j(),g(()=>Promise.resolve().then(()=>_),void 0).then(n=>n.startMusic()),e.getContext("2d").clearRect(0,0,e.width,e.height)}function De(){d.value="PLAYING",te(),A("PLAYING"),ot()}function an(){d.value="GAME_OVER",ve(),ee("gameover"),A("GAME_OVER",O.value,I.value)}const un=Object.freeze(Object.defineProperty({__proto__:null,continueGame:De,endGame:an,handlePlayerHit:ln,resetLevelFlow:te,showOverlay:A,startGame:Y},Symbol.toStringTag,{value:"Module"}));let ue=!1,ce=null,B=!1,ne=0;const qe=150;function cn(e){document.addEventListener("keydown",t=>{if(t.key==="p"&&!B){if(B=!0,d.value!=="PLAYING"&&d.value!=="PAUSED"){B=!1;return}const n=d.value==="PLAYING"?"PAUSED":"PLAYING";d.value=n,A(n),n==="PAUSED"?(F(),Ae()):n==="PLAYING"&&(j(),T()),setTimeout(()=>B=!1,300);return}if(d.value==="PLAYING")switch(t.key){case"ArrowUp":case"w":l.dy=-l.speed;break;case"ArrowDown":case"s":l.dy=l.speed;break;case"ArrowLeft":case"a":l.dx=-l.speed;break;case"ArrowRight":case"d":l.dx=l.speed;break;case" ":const n=Date.now();n-ne>qe&&(be(),ne=n);break}}),document.addEventListener("keyup",t=>{if(d.value==="PLAYING")switch(t.key){case"ArrowUp":case"w":case"ArrowDown":case"s":l.dy=0;break;case"ArrowLeft":case"a":case"ArrowRight":case"d":l.dx=0;break}}),e.addEventListener("mousemove",t=>{if(d.value!=="PLAYING")return;const n=e.getBoundingClientRect(),i=t.clientX-n.left,o=t.clientY-n.top;l.x=i-l.width/2,l.y=o-l.height/2}),e.addEventListener("mousedown",t=>{if(d.value!=="PLAYING"||t.button!==0||ue)return;ue=!0;function n(){if(!ue||d.value!=="PLAYING")return;const i=Date.now();i-ne>qe&&(be(),ne=i),ce=setTimeout(n,100)}n()}),e.addEventListener("mouseup",t=>{t.button===0&&Ae()}),e.addEventListener("contextmenu",t=>{if(t.preventDefault(),!B&&(d.value==="PLAYING"||d.value==="PAUSED")){B=!0;const n=d.value==="PLAYING"?"PAUSED":"PLAYING";d.value=n,A(n),n==="PAUSED"?(F(),Ae()):n==="PLAYING"&&(j(),T()),setTimeout(()=>B=!1,300)}})}function Ae(){ue=!1,ce&&(clearTimeout(ce),ce=null)}let oe=!1,Ce=0,ke=0,ie=null;function dn(e){ie=e,console.log("[DEBUG] setupMobileInput called"),setInterval(()=>{console.log("[DEBUG] gameState:",d.value)},1e3);function t(){console.log("[DEBUG] mobileLoop tick:",{active:oe,state:d.value}),oe&&d.value==="PLAYING"&&(fn(),be()),requestAnimationFrame(t)}requestAnimationFrame(t),e.addEventListener("touchstart",i=>{i.preventDefault();const o=i.touches[0];if(!o)return;const s=ie.getBoundingClientRect();Ce=o.clientX-s.left,ke=o.clientY-s.top,oe=!0,console.log("[DEBUG] TOUCH START"),(d.value==="START"||d.value==="PAUSED")&&(console.log("[DEBUG] Starting game from touch"),Y(ie),T())},{passive:!1}),e.addEventListener("touchmove",i=>{i.preventDefault();const o=i.touches[0];if(!o)return;const s=ie.getBoundingClientRect();Ce=o.clientX-s.left,ke=o.clientY-s.top},{passive:!1});const n=()=>{console.log("[DEBUG] TOUCH END"),oe=!1,d.value==="PLAYING"&&(console.log("[DEBUG] Switching state to PAUSED"),d.value="PAUSED",A("PAUSED"),F(),lt())};e.addEventListener("touchend",n,{passive:!1}),e.addEventListener("touchcancel",n,{passive:!1}),document.addEventListener("touchend",n),document.addEventListener("touchcancel",n)}function fn(){l.x=Ce-l.width/2,l.y=ke-l.height/2}function hn(){const e=document.getElementById("gameCanvas"),t=document.getElementById("startButton"),n=document.getElementById("restartButton"),i=document.getElementById("continueButton"),o=document.getElementById("quitButton"),s=document.getElementById("starfieldCanvas");!p&&s&&Pt(s),Se(e),Ie(e),on(e),p?dn(e):cn(e),window.addEventListener("resize",()=>{Se(e),Ie(e)});let r=!1;p||(t.addEventListener("touchstart",u=>{u.preventDefault(),!(d.value!=="START"||r)&&(r=!0,g(()=>Promise.resolve().then(()=>_),void 0).then(c=>c.unlockAudio()),Y(e),T(),setTimeout(()=>r=!1,1e3))},{passive:!1}),t.addEventListener("click",()=>{d.value!=="START"||r||(r=!0,g(()=>Promise.resolve().then(()=>_),void 0).then(u=>u.unlockAudio()),Y(e),T(),setTimeout(()=>r=!1,1e3))})),n.addEventListener("touchstart",u=>{u.preventDefault(),Y(e),T()},{passive:!1}),n.addEventListener("click",()=>{Y(e),T()}),i.addEventListener("touchstart",u=>{u.preventDefault(),De(),T()},{passive:!1}),i.addEventListener("click",()=>{De(),T()}),o&&(o.addEventListener("touchstart",u=>{u.preventDefault(),_e()},{passive:!1}),o.addEventListener("click",()=>_e())),A("START")}window.addEventListener("DOMContentLoaded",hn);
